<!DOCTYPE html>
<html lang="null">
    
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Yet another blog">
    <title>Elixir Streams reload - Yet another blog</title>
    <meta name="author" content="Justin Calleja">
    <meta name="description" content="Yet another blog">
    
    
        <link rel="alternative" type="application/atom+xml" title="RSS" href="/atom.xml">
    
    <meta name="description" content="IntroThis post is based on Drew Olson‘s Elixir Streams. Since I’m just getting started with Elixir, I came across a few issues understanding the “Building an API with Streams” section in Drew’s post.">
<meta property="og:type" content="blog">
<meta property="og:title" content="Elixir Streams reload">
<meta property="og:url" content="http://justincalleja.com/2016/01/26/elixir-streams-reload/index.html">
<meta property="og:site_name" content="Yet another blog">
<meta property="og:description" content="IntroThis post is based on Drew Olson‘s Elixir Streams. Since I’m just getting started with Elixir, I came across a few issues understanding the “Building an API with Streams” section in Drew’s post.">
<meta property="og:updated_time" content="2020-03-26T16:37:01.014Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Elixir Streams reload">
<meta name="twitter:description" content="IntroThis post is based on Drew Olson‘s Elixir Streams. Since I’m just getting started with Elixir, I came across a few issues understanding the “Building an API with Streams” section in Drew’s post.">
    
    
    
    
    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/font-awesome.css" type="text/css">
    <link rel="stylesheet" href="/assets/css/jquery.fancybox.css" type="text/css">
    <link rel="stylesheet" href="/assets/css/jquery.fancybox-thumbs.css" type="text/css">
    <link rel="stylesheet" href="/assets/css/tranquilpeak.css" type="text/css">
    <!--STYLES END-->
    <link rel="stylesheet" href="/assets/css/blog.css" type="text/css">
    
    <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-57452463-1']);
        _gaq.push(['_trackPageview']);
        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>

</head>

    <body>
        <div id="blog">
            <header id="header" data-behavior="1">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <h1 class="header-title">
        <a class="header-title-link" href="/ ">Yet another blog</a>
    </h1>
    
</header>
            <nav id="sidebar" data-behavior="1">
    
    
    <ul class="sidebar-buttons">
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link "
                    href="/ 
                    ">
            
                    <i class="sidebar-button-icon fa fa-lg fa-home"></i>
                    <span class="sidebar-button-desc">Home</span>
                </a>
        </li>
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link "
                    href="/all-categories
                            ">
            
                    <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
                    <span class="sidebar-button-desc">Categories</span>
                </a>
        </li>
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link "
                    href="/all-tags
                            ">
            
                    <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
                    <span class="sidebar-button-desc">Tags</span>
                </a>
        </li>
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link "
                    href="/all-archives
                            ">
            
                    <i class="sidebar-button-icon fa fa-lg fa-archive"></i>
                    <span class="sidebar-button-desc">Archives</span>
                </a>
        </li>
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link st-search-show-outputs"
                    href="/#search
                            ">
            
                    <i class="sidebar-button-icon fa fa-lg fa-search"></i>
                    <span class="sidebar-button-desc">Search</span>
                </a>
        </li>
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link "
                    href="/#about
                            ">
            
                    <i class="sidebar-button-icon fa fa-lg fa-question"></i>
                    <span class="sidebar-button-desc">About me</span>
                </a>
        </li>
        
    </ul>
    
    <ul class="sidebar-buttons">
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link " href="https://github.com/justincalleja" target="_blank">
            
                    <i class="sidebar-button-icon fa fa-lg fa-github"></i>
                    <span class="sidebar-button-desc">GitHub (has blog)</span>
                </a>
        </li>
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link " href="https://github.com/justin-calleja" target="_blank">
            
                    <i class="sidebar-button-icon fa fa-lg fa-github"></i>
                    <span class="sidebar-button-desc">GitHub</span>
                </a>
        </li>
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link " href="https://twitter.com/justin_calleja" target="_blank">
            
                    <i class="sidebar-button-icon fa fa-lg fa-twitter"></i>
                    <span class="sidebar-button-desc">Twitter</span>
                </a>
        </li>
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link " href="https://www.linkedin.com/pub/justin-calleja/29/334/b28" target="_blank">
            
                    <i class="sidebar-button-icon fa fa-lg fa-linkedin"></i>
                    <span class="sidebar-button-desc">Linked In</span>
                </a>
        </li>
        
    </ul>
    
    <ul class="sidebar-buttons">
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link "
                    href="/atom.xml
                            ">
            
                    <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
                    <span class="sidebar-button-desc">RSS</span>
                </a>
        </li>
        
    </ul>
    
</nav>
            <div id="main" data-behavior="1">
                
<article class="post" itemscope itemType="http://schema.org/BlogPosting">
    
        <div class="post-header main-content-wrap">
    
        <h1 class="post-title" itemprop="headline">Elixir Streams reload</h1>
    
    <div class="post-meta">
    <time  itemprop="datePublished" content="Tue Jan 26 2016 01:00:00 GMT+0100">
        Jan 26, 2016
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/programming/">programming</a>


    
</div>
</div>
    
    <div class="post-content markdown main-content-wrap" itemprop="articleBody">
        
          
            <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Intro"><span class="toc-number">1.</span> <span class="toc-text">Intro</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Intro-some-more"><span class="toc-number">1.1.</span> <span class="toc-text">Intro some more</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#The-intention"><span class="toc-number">2.</span> <span class="toc-text">The intention</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#How-to-fetch-Github-organization-repos-and-their-pagination"><span class="toc-number">2.1.</span> <span class="toc-text">How to fetch Github organization repos and their pagination</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Quick-intro-to-streams"><span class="toc-number">2.2.</span> <span class="toc-text">Quick intro to streams</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Know-your-poison"><span class="toc-number">3.</span> <span class="toc-text">Know your poison</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#HTTPoison"><span class="toc-number">3.1.</span> <span class="toc-text">HTTPoison</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Poison"><span class="toc-number">3.2.</span> <span class="toc-text">Poison</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Building-an-API-with-Streams"><span class="toc-number">4.</span> <span class="toc-text">Building an API with Streams</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Stream-resource-3"><span class="toc-number">4.1.</span> <span class="toc-text">Stream.resource/3</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#The-rest-of-Github-ResultStream"><span class="toc-number">4.2.</span> <span class="toc-text">The rest of Github.ResultStream</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Test-drive"><span class="toc-number">5.</span> <span class="toc-text">Test drive</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#How-to-install-Elixir-with-asdf"><span class="toc-number">6.</span> <span class="toc-text">How to install Elixir with asdf</span></a></li></ol>
          
            <h1 id="Intro"><a href="#Intro" class="headerlink" title="Intro"></a>Intro</h1><p>This post is based on <a href="http://drewolson.org/" target="_blank" rel="external">Drew Olson</a>‘s <a href="http://blog.drewolson.org/elixir-streams/" target="_blank" rel="external">Elixir Streams</a>. Since I’m just getting started with <a href="http://elixir-lang.org/" target="_blank" rel="external">Elixir</a>, I came across a few issues understanding the <a href="http://blog.drewolson.org/elixir-streams/#buildinganapiwithstreams" target="_blank" rel="external">“Building an API with Streams”</a> section in Drew’s post. This post is my attempt at breaking it down while learning about Elixir.</p>
<p>I’m using <a href="http://elixir-lang.org/" target="_blank" rel="external">Elixir</a> 1.2.0 (and <a href="http://www.erlang.org/" target="_blank" rel="external">Erlang</a> 18.1).</p>
<h2 id="Intro-some-more"><a href="#Intro-some-more" class="headerlink" title="Intro some more"></a>Intro some more</h2><ul>
<li>The code for the main example is up on <a href="https://github.com/justin-calleja/elixir-streams-reload" target="_blank" rel="external">Github</a></li>
<li>There is a <a href="#How_to_install_Elixir_with_asdf">How to install Elixir with asdf</a> section at the end if you don’t have Elixir and want a quick way of installing it</li>
<li>I will not be using the exact Github endpoint (e.g. <a href="https://github.com/api/v3/orgs/elixir-lang/repos" target="_blank" rel="external">https://github.com/api/v3/orgs/elixir-lang/repos</a>) used in Drew’s post because:<ul>
<li>I’m not familiar with the Github API</li>
<li>Couldn’t get the given endpoint to work after generating an access token</li>
<li>Got the data I wanted anyway using the endpoint in this post (no need for access tokens)</li>
<li>It cuts down on code :)</li>
</ul>
</li>
<li>This post is primarily a “learning devise”, by which I mean I intend to side track from the main intention below to explain (or mention and link to) Elixir basics. i.e. this post is not really about Elixir Streams although it features them. The original idea for this post was to learn some Elixir basics in the context of the app in Drew’s <a href="http://blog.drewolson.org/elixir-streams/#buildinganapiwithstreams" target="_blank" rel="external">“Building an API with Streams”</a> section.</li>
<li>Code example in the “Building an API with Streams” section in Drew’s post has been tweaked to work with Elixir version 1.2.0.</li>
<li><strong>This is a long and winding one…</strong> - you have been warned :)</li>
</ul>
<h1 id="The-intention"><a href="#The-intention" class="headerlink" title="The intention"></a>The intention</h1><p>We want to write an Elixir module to expose an Elixir based API around the <a href="https://developer.github.com/v3/" target="_blank" rel="external">Github REST API</a> in such a way as to hide pagination from users of our API. Our API will give users <a href="http://elixir-lang.org/docs/v1.2/elixir/Stream.html" target="_blank" rel="external">stream</a>s to work with. As we’ll see, this means we never hit Github unless the user actually reads from the stream, and we only paginate as much as necessary (depending on how much the user reads from the stream and how many pages Github has for the particular resource).</p>
<p>It’s probably best to go over this intention in more detail.</p>
<h2 id="How-to-fetch-Github-organization-repos-and-their-pagination"><a href="#How-to-fetch-Github-organization-repos-and-their-pagination" class="headerlink" title="How to fetch Github organization repos and their pagination"></a>How to fetch Github organization repos and their pagination</h2><p>We will only be concerned with a single endpoint from Github’s API in this post, namely, <em>listing the repositories of a specific organization</em>. So let’s start off with the <a href="https://github.com/elixir-lang" target="_blank" rel="external">elixir-lang</a> organization. If you open the following in a browser: <a href="https://api.github.com/orgs/elixir-lang/repos" target="_blank" rel="external">https://api.github.com/orgs/elixir-lang/repos</a>, you should get back something like:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    "id": 1234714,</span><br><span class="line">      "name": "elixir",</span><br><span class="line">      "full_name": "elixir-lang/elixir",</span><br><span class="line">      ...</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    "id": 1467845,</span><br><span class="line">    "name": "elixir-tmbundle",</span><br><span class="line">    "full_name": "elixir-lang/elixir-tmbundle",</span><br><span class="line">    ...</span><br><span class="line">  &#125;,</span><br><span class="line">  ...</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>Opening your browser’s dev tools, you’ll also be able to look at the HTTP response headers from the API (or <code>curl -i https://api.github.com/orgs/elixir-lang/repos | less</code> if you’re on a Unixy system). At the time of writing, you will see that there is no <code>Link</code> header for <code>elixir-lang</code> as it hasn’t got enough repos to necessitate pagination.</p>
<p>Maybe there’s a parameter to limit the number of returned repos - in which case, you’d be able to trigger pagination like that. But I’m too lazy to look into that so I’ll just pick something like: <a href="https://api.github.com/orgs/nodejs/repos" target="_blank" rel="external">https://api.github.com/orgs/nodejs/repos</a>, which gives back this <code>Link</code> header:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="constant">Link:</span> &lt;<span class="symbol">https:</span>/<span class="regexp">/api.github.com/organizations</span><span class="regexp">/9950313/repos</span>?page=<span class="number">2</span>&gt;; rel=<span class="string">"next"</span>,</span><br><span class="line">      &lt;<span class="symbol">https:</span>/<span class="regexp">/api.github.com/organizations</span><span class="regexp">/9950313/repos</span>?page=<span class="number">3</span>&gt;; rel=<span class="string">"last"</span></span><br></pre></td></tr></table></figure>
<p>Using a tool like <a href="https://stedolan.github.io/jq/" target="_blank" rel="external">jq</a>, we can easily count how many repos we just got back:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ curl <span class="operator">-s</span> <span class="string">"https://api.github.com/orgs/nodejs/repos"</span> | jq <span class="string">'. | length'</span></span><br><span class="line"><span class="number">30</span></span><br></pre></td></tr></table></figure>
<p>So now we know that we’ll only ever get a maximum of 30 repos for each such request we make to Github. If the organization happens to have more than 30 repos, we’ll need to follow the link with <code>rel=&quot;next&quot;</code>, and so on, until there are no more repos to get - i.e. we need to paginate.</p>
<p><em>But</em>, we don’t want to paginate unless the user actually wants more data - which is why we give the user a stream.</p>
<h2 id="Quick-intro-to-streams"><a href="#Quick-intro-to-streams" class="headerlink" title="Quick intro to streams"></a>Quick intro to streams</h2><p>The thing about streams is… they’re lazy… and they’re enumerable.</p>
<p><a href="http://elixir-lang.org/docs/v1.2/elixir/Stream.html" target="_blank" rel="external">Stream</a> the Elixir module, like the <a href="http://elixir-lang.org/docs/v1.2/elixir/Enum.html" target="_blank" rel="external">Enum</a> module, works on <a href="http://elixir-lang.org/docs/v1.2/elixir/Enumerable.html" target="_blank" rel="external">Enumerable</a> things. But a stream itself is some kind of data structure which implements the Enumerable <a href="http://elixir-lang.org/getting-started/protocols.html" target="_blank" rel="external">protocol</a> (making it an Enumerable thing). This means that streams, like other Enumerables, <a href="https://github.com/elixir-lang/elixir/blob/v1.2/lib/elixir/lib/stream.ex#L1222-L1238" target="_blank" rel="external">implement</a>:</p>
<ul>
<li>Enumerable.count/1</li>
<li>Enumerable.member?/2</li>
<li>Enumerable.reduce/3</li>
</ul>
<p>just like all the following Enumerables (checkout <a href="https://github.com/elixir-lang/elixir" target="_blank" rel="external">elixir</a>):</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">~<span class="regexp">/github-stuff/elixir</span><span class="variable">$ </span>egrep -<span class="constant">R</span> -n --exclude-dir=&#123;bin,\.git&#125; <span class="string">".*defimpl Enumerable.*"</span> .</span><br><span class="line">./<span class="class"><span class="keyword">lib</span>/<span class="title">elixir</span>/<span class="title">lib</span>/<span class="title">enum</span>.<span class="title">ex</span>:2748:<span class="title">defimpl</span> <span class="title">Enumerable</span>, <span class="title">for</span>: <span class="title">List</span> <span class="title">do</span></span></span><br><span class="line">./<span class="class"><span class="keyword">lib</span>/<span class="title">elixir</span>/<span class="title">lib</span>/<span class="title">enum</span>.<span class="title">ex</span>:2760:<span class="title">defimpl</span> <span class="title">Enumerable</span>, <span class="title">for</span>: <span class="title">Map</span> <span class="title">do</span></span></span><br><span class="line">./<span class="class"><span class="keyword">lib</span>/<span class="title">elixir</span>/<span class="title">lib</span>/<span class="title">enum</span>.<span class="title">ex</span>:2783:<span class="title">defimpl</span> <span class="title">Enumerable</span>, <span class="title">for</span>: <span class="title">Function</span> <span class="title">do</span></span></span><br><span class="line">./<span class="class"><span class="keyword">lib</span>/<span class="title">elixir</span>/<span class="title">lib</span>/<span class="title">file</span>/<span class="title">stream</span>.<span class="title">ex</span>:68:  <span class="title">defimpl</span> <span class="title">Enumerable</span> <span class="title">do</span></span></span><br><span class="line">./<span class="class"><span class="keyword">lib</span>/<span class="title">elixir</span>/<span class="title">lib</span>/<span class="title">gen_event</span>/<span class="title">stream</span>.<span class="title">ex</span>:58:<span class="title">defimpl</span> <span class="title">Enumerable</span>, <span class="title">for</span>: <span class="title">GenEvent</span>.<span class="title">Stream</span> <span class="title">do</span></span></span><br><span class="line">./<span class="class"><span class="keyword">lib</span>/<span class="title">elixir</span>/<span class="title">lib</span>/<span class="title">hash_dict</span>.<span class="title">ex</span>:220:<span class="title">defimpl</span> <span class="title">Enumerable</span>, <span class="title">for</span>: <span class="title">HashDict</span> <span class="title">do</span></span></span><br><span class="line">./<span class="class"><span class="keyword">lib</span>/<span class="title">elixir</span>/<span class="title">lib</span>/<span class="title">hash_set</span>.<span class="title">ex</span>:235:<span class="title">defimpl</span> <span class="title">Enumerable</span>, <span class="title">for</span>: <span class="title">HashSet</span> <span class="title">do</span></span></span><br><span class="line">./<span class="class"><span class="keyword">lib</span>/<span class="title">elixir</span>/<span class="title">lib</span>/<span class="title">io</span>/<span class="title">stream</span>.<span class="title">ex</span>:49:  <span class="title">defimpl</span> <span class="title">Enumerable</span> <span class="title">do</span></span></span><br><span class="line">./<span class="class"><span class="keyword">lib</span>/<span class="title">elixir</span>/<span class="title">lib</span>/<span class="title">map_set</span>.<span class="title">ex</span>:266:  <span class="title">defimpl</span> <span class="title">Enumerable</span> <span class="title">do</span></span></span><br><span class="line">./<span class="class"><span class="keyword">lib</span>/<span class="title">elixir</span>/<span class="title">lib</span>/<span class="title">range</span>.<span class="title">ex</span>:66:<span class="title">defimpl</span> <span class="title">Enumerable</span>, <span class="title">for</span>: <span class="title">Range</span> <span class="title">do</span></span></span><br><span class="line">./<span class="class"><span class="keyword">lib</span>/<span class="title">elixir</span>/<span class="title">lib</span>/<span class="title">stream</span>.<span class="title">ex</span>:1222:<span class="title">defimpl</span> <span class="title">Enumerable</span>, <span class="title">for</span>: <span class="title">Stream</span> <span class="title">do</span></span></span><br></pre></td></tr></table></figure>
<p>That’s great, but maybe not so practical right now. Let’s focus on the <strong>lazy</strong> property of streams which is what we’ll leverage to paginate on an “as-needed” basis.</p>
<p>Being lazy, you can define any transformation you want on streams using the API in the <a href="http://elixir-lang.org/docs/v1.2/elixir/Stream.html" target="_blank" rel="external">Stream</a> module, but doing so will <strong>not</strong> trigger the stream’s enumeration. This means that “nothing” will actually happen when you define a stream or make one from another using the Stream module’s API.</p>
<p>Consider the following (adapted from the <a href="http://elixir-lang.org/docs/v1.2/elixir/Stream.html#map/2" target="_blank" rel="external">online doc</a>):</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">iex(<span class="number">1</span>)&gt; stream = <span class="constant">Stream.</span>map([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], <span class="keyword">fn</span>(x) -&gt; <span class="constant">IO.</span>puts <span class="string">"x is <span class="subst">#&#123;x&#125;</span>"</span>; x * <span class="number">2</span> <span class="keyword">end</span>)</span><br><span class="line"><span class="comment">#Stream&lt;[enum: [1, 2, 3], funs: [#Function&lt;44.120526864/1 in Stream.map/2&gt;]]&gt;</span></span><br><span class="line">iex(<span class="number">2</span>)&gt; <span class="constant">Enum.</span>to_list(stream)</span><br><span class="line">x is <span class="number">1</span></span><br><span class="line">x is <span class="number">2</span></span><br><span class="line">x is <span class="number">3</span></span><br><span class="line">[<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>]</span><br></pre></td></tr></table></figure>
<p>In our first expression (<code>iex(1)&gt;</code>), we are creating a stream from a list and a function, using <a href="http://elixir-lang.org/docs/v1.2/elixir/Stream.html#map/2" target="_blank" rel="external">Stream.map/2</a>. The REPL shows us that we got back a stream from <code>Stream.map/2</code>. It shows us a human readable string <a href="https://github.com/elixir-lang/elixir/blob/v1.2/lib/elixir/lib/stream.ex#L1268-L1274" target="_blank" rel="external">based on</a> the <a href="http://elixir-lang.org/docs/v1.2/elixir/Inspect.html" target="_blank" rel="external">Inspect</a> protocol. As a side note:</p>
<blockquote>Keep in mind that, by convention, whenever the inspected value starts with #, it is representing a data structure in non-valid Elixir syntax.<footer><cite><a href="http://elixir-lang.org/getting-started/protocols.html" target="_blank" rel="external">Protocols</a></cite></footer></blockquote>

<p>In other words, the <code>stream</code> variable is now bound to a stream - “some kind of data structure” - the innards of which you should make no assumptions on (as they <em>might</em> change in different versions of Elixir).</p>
<p>In our second expression (<code>iex(2)&gt;</code>), we’re using <a href="http://elixir-lang.org/docs/v1.1/elixir/Enum.html#to_list/1" target="_blank" rel="external">Enum.to_list/1</a> to convert the stream data structure to an Erlang/Elixir list. On doing so, <code>to_list/1</code> is internally calling <a href="http://elixir-lang.org/docs/v1.2/elixir/Enumerable.html#reduce/3" target="_blank" rel="external">Enumerable.reduce/3</a> on the stream we pass to it which will “force” the lazy stream to produce something. In the case of <code>to_list/1</code>, the stream is “forced” to keep producing values until it’s exhausted.</p>
<p>That is why we don’t see the side effect of printing to stdout until we actually trigger the stream’s enumeration.</p>
<p>Of course, we don’t <em>have</em> to exhaust the stream. We can just take what we want from it, e.g. using <a href="http://elixir-lang.org/docs/v1.1/elixir/Enum.html#take/2" target="_blank" rel="external">Enum.take/2</a>:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">iex(<span class="number">3</span>)&gt; <span class="constant">Enum.</span>take(stream, <span class="number">1</span>)</span><br><span class="line">x is <span class="number">1</span></span><br><span class="line">[<span class="number">2</span>]</span><br></pre></td></tr></table></figure>
<p>But consider this:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iex(<span class="number">4</span>)&gt; <span class="constant">Enum.</span>take([<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>], <span class="number">1</span>)</span><br><span class="line">[<span class="number">4</span>]</span><br></pre></td></tr></table></figure>
<p>What’s different here? The difference is that the data you <code>take/2</code> from <code>stream</code> doesn’t actually exist until you take it, whereas that from <code>[4, 5, 6]</code> exists in memory before ever calling <code>take/2</code> on it. Granted, in this case, <code>stream</code> is lazily producing data from a list data source which exists in memory (i.e. <code>[1, 2, 3]</code>). This might make the distinction a little more nuanced for this particular example, but what’s important to keep in mind is that the actual values the <code>stream</code> produces (<code>1</code>, <code>2</code>, and <code>3</code>) <em>don’t exist</em> in memory until the stream is actually consumed. Our <code>stream</code> could just as easily be feeding our program data from a database or a REST API instead of an in-memory data structure.</p>
<p>For example, it could be giving <code>Enum.take/2</code> data it got from its first HTTP request to Github’s REST API. If <code>take/2</code> doesn’t want more than 30 repos, then <code>stream</code> only ever needs to make 1 HTTP request. If <code>take/2</code> wants more, <code>stream</code> would have to paginate as necessary but at least <code>take/2</code> doesn’t have to wait until <code>stream</code> makes enough requests to exhaust the number of repos for a particular organization before it starts receiving data from <code>stream</code>.</p>
<p>That is exactly what we want for the Elixir API we’ll be writing.</p>
<p>But first…</p>
<h1 id="Know-your-poison"><a href="#Know-your-poison" class="headerlink" title="Know your poison"></a>Know your poison</h1><p>The example coming up next makes use of <a href="https://github.com/edgurgel/httpoison" target="_blank" rel="external">HTTPoison</a> as well as the more mainstream (but no less deadly) <a href="https://github.com/devinus/poison" target="_blank" rel="external">Poison</a> modules - so it makes sense to cover basic usage of each before digging in.</p>
<p>Bootstrap a new project with <code>mix new github</code>; <code>cd</code> into it, and add these modules as dependencies in <code>mix.exs</code>:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">defp</span> <span class="title">deps</span></span> <span class="keyword">do</span></span><br><span class="line">  [&#123;<span class="symbol">:httpoison</span>, <span class="string">"~&gt; 0.8.0"</span>&#125;, &#123;<span class="symbol">:poison</span>, <span class="string">"~&gt; 1.5"</span>&#125;]</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>Then run <code>mix deps.get</code> to fetch the poisonous bunch.</p>
<h2 id="HTTPoison"><a href="#HTTPoison" class="headerlink" title="HTTPoison"></a>HTTPoison</h2><p>First things first. Unless you fancy manually starting the HTTPoison applicaiton every time you load <code>iex</code> (with <code>HTTPoison.start</code>), add it as an application in mix.exs:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">application</span></span> <span class="keyword">do</span></span><br><span class="line">  [<span class="symbol">applications:</span> [<span class="symbol">:logger</span>, <span class="symbol">:httpoison</span>]]</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>It seems that some processes need to be running before using HTTPoison and adding <code>:httpoison</code> in the <code>applications</code> <a href="http://elixir-lang.org/getting-started/maps-and-dicts.html#keyword-lists" target="_blank" rel="external">keyword list</a> will automatically make this happen. I’m guessing that modules listed in <code>applications</code> have their <a href="https://github.com/edgurgel/httpoison/blob/v0.8.0/lib/httpoison/base.ex#L81" target="_blank" rel="external">start</a> function called by <a href="https://github.com/elixir-lang/elixir/tree/master/lib/mix" target="_blank" rel="external">mix</a> which then spawn the processes, but I’m not entirely sure how that works.</p>
<p>In HTTPoison’s case, Erlang’s <a href="http://www.erlang.org/doc/apps/kernel/application.html#ensure_started-1" target="_blank" rel="external">application:ensure_all_started/1</a> seems to be what’s making this happen.</p>
<p>In any case, starting iex and loading our app with <a href="https://github.com/elixir-lang/elixir/wiki/FAQ#3-how-do-i-start-a-shell-iex-with-my-project-and-all-its-dependencies-loaded-and-started" target="_blank" rel="external">iex -S mix</a> (which starts a shell with the project and all of its dependencies loaded and started), we can now start experimenting a bit:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iex(<span class="number">1</span>)&gt; <span class="constant">HTTPoison.</span>get! <span class="string">"https://api.github.com/orgs/elixir-lang/repos"</span></span><br><span class="line"><span class="comment"># ...</span></span><br></pre></td></tr></table></figure>
<p>should give you back a bunch of data with a status code of 200. From the example request in the project’s <a href="https://github.com/edgurgel/httpoison" target="_blank" rel="external">README.md</a> (and from <a href="https://github.com/edgurgel/httpoison/blob/v0.8.0/lib/httpoison.ex#L2" target="_blank" rel="external">this</a>), we can see that the response we get back is a <code>HTTPoison.Response</code> <a href="http://elixir-lang.org/getting-started/structs.html" target="_blank" rel="external">struct</a> with an integer <code>status_code</code>, a binary <code>body</code>, and a list for <code>headers</code>:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iex(<span class="number">2</span>)&gt; %<span class="constant">HTTPoison.Response&#123;</span><span class="symbol">body:</span> body, <span class="symbol">headers:</span> headers, <span class="symbol">status_code:</span> status_code&#125; = v(<span class="number">1</span>)</span><br><span class="line"><span class="comment"># ...</span></span><br></pre></td></tr></table></figure>
<p>Above, we’re getting the evaluation of expression 1 in iex (i.e. the result of <code>iex(1)&gt;</code>) and extracting its individual parts using <a href="http://elixir-lang.org/getting-started/pattern-matching.html" target="_blank" rel="external">pattern matching</a> (we’re using the <a href="http://elixir-lang.org/docs/master/iex/IEx.Helpers.html#v/1" target="_blank" rel="external">v(n \\ -1)</a> iex helper function to do this - and note that the double backslash syntax in the helper function’s doc is for <a href="http://elixir-lang.org/getting-started/modules.html#default-arguments" target="_blank" rel="external">default arguments</a>). We now have the following bound variables in our iex session: <code>body</code>, <code>headers</code>, and <code>status_code</code>.</p>
<p>Next, add <code>lib/github_gateway.ex</code>:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># lib/github_gateway.ex</span></span><br><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">Github</span></span>.<span class="constant">Gateway </span><span class="keyword">do</span></span><br><span class="line">  <span class="keyword">use</span> <span class="constant">HTTPoison.Base</span></span><br><span class="line"></span><br><span class="line">  <span class="variable">@endpoint</span> <span class="string">"https://api.github.com"</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">endpoint</span></span> <span class="keyword">do</span></span><br><span class="line">    <span class="variable">@endpoint</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">defp</span> <span class="title">process_url</span></span>(url) <span class="keyword">do</span></span><br><span class="line">    <span class="variable">@endpoint</span> &lt;&gt; url</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>There’s a couple of things to note here. The easiest to explain is the definition of the <code>@endpoint</code> <a href="http://elixir-lang.org/getting-started/module-attributes.html#as-constants" target="_blank" rel="external">module attribute</a> which serves as a constant. At compile time, usage of this attribute is changed to the Github endpoint we’ve set it to.</p>
<p>We’re also using <code>use HTTPoison.Base</code>, and as we can see from the <a href="http://elixir-lang.org/getting-started/alias-require-and-import.html#use" target="_blank" rel="external">online doc</a>, this is compiled to something like:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">Github</span></span>.<span class="constant">Gateway </span><span class="keyword">do</span></span><br><span class="line">  require <span class="constant">HTTPoison.Base</span></span><br><span class="line">  <span class="constant">HTTPoison.Base.__using__ </span>[]</span><br><span class="line">  <span class="comment"># ...</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<blockquote>Behind the scenes, <code>use</code> requires the given module and then calls the <code>__using__/1</code> callback on it allowing the module to inject some code into the current context.<footer><cite><a href="http://elixir-lang.org/getting-started/alias-require-and-import.html#use" target="_blank" rel="external">Getting started guide</a></cite></footer></blockquote>

<p>(note: I’m passing <code>__using__/1</code> an empty list as an argument above. This list is an empty <a href="http://elixir-lang.org/getting-started/maps-and-dicts.html#keyword-lists" target="_blank" rel="external">keyword list</a>, which means that if it weren’t empty (i.e. if we had passed any options to the module we were <code>use</code>ing), they would be present in this list when the <code>use</code> macro is expanded in the form of 2-element tuples with an atom for the first element).</p>
<p><code>require</code>ing seems to be necessary to “guarantee” that <code>HTTPoison.Base</code> is available during compilation:</p>
<blockquote>Macros are chunks of code that are executed and expanded at compilation time. This means, in order to use a macro, we need to guarantee its module and implementation are available during compilation. This is done with the <code>require</code> directive<footer><cite><a href="http://elixir-lang.org/getting-started/alias-require-and-import.html#require" target="_blank" rel="external">Getting started guide</a></cite></footer></blockquote>

<p>However, when the compiler is processing this, “code injection” (or “macro expansion”) isn’t over after just the first step above (the expansion of the <code>use</code> macro) because <a href="https://github.com/edgurgel/httpoison/blob/v0.8.0/lib/httpoison/base.ex#L74" target="_blank" rel="external">HTTPoison.Base.__using__/1</a> is itself a macro, so it needs to be expanded too.</p>
<p>If you have just a quick look at <a href="https://github.com/edgurgel/httpoison/blob/v0.8.0/lib/httpoison/base.ex#L74" target="_blank" rel="external">HTTPoison.Base.__using__/1</a>, you’ll see that it’s defining a bunch of functions within a <a href="http://elixir-lang.org/getting-started/meta/quote-and-unquote.html#quoting" target="_blank" rel="external">quote</a> block. Basically, we can write normal Elixir code within <code>quote</code> blocks and all that code will be transformed into a data structure which is understood by, and fed to, the Elixir compiler during macro expansion.</p>
<p>Effectively, it’s as if the functions in this <code>quote</code> block were defined in our module, <code>Github.Gateway</code>.</p>
<p>You can confirm this by removing the <code>use HTTPoison.Base</code> expression in <code>Github.Gateway</code> (or replacing <code>use</code> with <code>require</code> without calling the <code>__using__/1</code> macro). If you then <code>iex -S mix</code> and hit the <code>&lt;TAB&gt;</code> key after <code>Github.Gateway.</code>, it will expand to the only thing available in that module at this point, the public <code>endpoint</code> function. If you <code>use HTTPoison.Base</code> and try the same thing, you’ll get a list of the injected code:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">iex(1)&gt; Github.Gateway.</span><br><span class="line">delete!/3     delete/3      endpoint/0    get!/3        get/3</span><br><span class="line">head!/3       head/3        options!/3    options/3     patch!/4</span><br><span class="line">patch/4       post!/4       post/4        put!/4        put/4</span><br><span class="line">request!/5    request/5     start/0</span><br></pre></td></tr></table></figure>
<p>As you can see, we now have <a href="https://github.com/edgurgel/httpoison/blob/v0.8.0/lib/httpoison/base.ex#L194" target="_blank" rel="external">get!/3</a>, the same function we used from <code>HTTPoison</code> just a minute ago. <a href="https://github.com/edgurgel/httpoison/blob/v0.8.0/lib/httpoison.ex#L44-L67" target="_blank" rel="external">In fact</a>:</p>
<blockquote>Under the hood, the <a href="http://hexdocs.pm/httpoison/HTTPoison.html#content" target="_blank" rel="external">HTTPoison</a> module just uses <a href="http://hexdocs.pm/httpoison/HTTPoison.Base.html" target="_blank" rel="external">HTTPoison.Base</a>… without overriding any default function.<footer><cite><a href="http://hexdocs.pm/httpoison/HTTPoison.html#content" target="_blank" rel="external">HTTPoison docs</a></cite></footer></blockquote>

<p>However, since we’ve defined our own <code>process_url/1</code> function, we don’t need to specify the full URL to make a similar request to the one we’ve made before:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iex(<span class="number">1</span>)&gt; <span class="constant">Github.Gateway.</span>get! <span class="string">"/orgs/elixir-lang/repos"</span></span><br><span class="line"><span class="comment"># ...</span></span><br></pre></td></tr></table></figure>
<p>In fact, we <em>can’t</em> specify the full URL as a parameter since we’ve changed the <a href="https://github.com/edgurgel/httpoison/blob/v0.8.0/lib/httpoison/base.ex#L83-L85" target="_blank" rel="external">default</a> <a href="https://github.com/edgurgel/httpoison/blob/v0.8.0/lib/httpoison/base.ex#L354-L361" target="_blank" rel="external">implementation</a> of <code>process_url/1</code> to:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">defp</span> <span class="title">process_url</span></span>(url) <span class="keyword">do</span></span><br><span class="line">  <span class="variable">@endpoint</span> &lt;&gt; url</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>and we’d have an invalid URL if we did.</p>
<p>The HTTPoison documentation is clear about this “overriding” feature:</p>
<blockquote>HTTPoison.Base defines the following list of functions, all of which can be overridden (by redefining them)…<footer><cite><a href="http://hexdocs.pm/httpoison/HTTPoison.Base.html" target="_blank" rel="external">HTTPoison.Base docs</a></cite></footer></blockquote>

<p>OK… but it’s not like this is <a href="https://en.wikipedia.org/wiki/Object-oriented_programming" target="_blank" rel="external">OOP</a> and looking into <code>use</code>ing a module doesn’t explain anything about function overriding. So how does this work?</p>
<p>To better understand what’s going on, we need to dig a bit deeper. We know that <code>HTTPoison.Base.__using__/1</code> macro is expanded at compile time when <code>use</code>ing <code>HTTPoison.Base</code>, and if we look into it, we come across this <a href="https://github.com/edgurgel/httpoison/blob/v0.8.0/lib/httpoison/base.ex#L329" target="_blank" rel="external">line</a> in the macro’s definition:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">defoverridable <span class="constant">Module.</span>definitions_in(<span class="constant">__MODULE__)</span></span><br></pre></td></tr></table></figure>
<p><a href="https://github.com/elixir-lang/elixir/blob/v1.2/lib/elixir/lib/module.ex#L731-L746" target="_blank" rel="external">Module.definitions_in/1</a> is being passed the <a href="http://elixir-lang.org/docs/v1.2/elixir/Kernel.SpecialForms.html#__MODULE__/0" target="_blank" rel="external">__MODULE__/0</a> pseudo variable, the evaluation of which seems to be listing all functions defined in <code>HTTPoison.Base</code>.</p>
<blockquote>Pseudo variables return information about Elixir’s compilation environment and can only be read, never assigned to.<footer><cite><a href="http://elixir-lang.org/docs/v1.2/elixir/Kernel.SpecialForms.html" target="_blank" rel="external">Pseudo variables</a></cite></footer></blockquote>

<p>If we now take a look at the <a href="https://github.com/elixir-lang/elixir/blob/v1.2/lib/elixir/lib/kernel.ex#L3501-L3537" target="_blank" rel="external">Kernel.defoverridable/1</a> macro, we’ll find out that this is what’s responsible for the overridability feature:</p>
<blockquote>Makes the given functions in the current module overridable.<br>An overridable function is lazily defined, allowing a developer to override it.<footer><cite><a href="https://github.com/elixir-lang/elixir/blob/v1.2/lib/elixir/lib/kernel.ex#L3501-L3537" target="_blank" rel="external">Kernel.defoverridable/1 doc</a></cite></footer></blockquote>

<p>It’s also interesting to note the example which comes with the doc for that macro:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">DefaultMod</span></span> <span class="keyword">do</span></span><br><span class="line">  <span class="function"><span class="keyword">defmacro</span> <span class="title">__using__</span></span>(<span class="constant">_opts)</span> <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">quote</span> <span class="keyword">do</span></span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">test</span></span>(x, y) <span class="keyword">do</span></span><br><span class="line">        x + y</span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line">      defoverridable [<span class="symbol">test:</span> <span class="number">2</span>]</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">InheritMod</span></span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">use</span> <span class="constant">DefaultMod</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">test</span></span>(x, y) <span class="keyword">do</span></span><br><span class="line">    x * y + super(x, y)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>Apart from noticing that <code>defoverridable/1</code> takes a <a href="http://elixir-lang.org/getting-started/maps-and-dicts.html#keyword-lists" target="_blank" rel="external">keyword list</a> as an argument, implying that <code>Module.definitions_in/1</code> returns a keyword list, we can see usage of <code>super</code> to call the default implementation of <code>test</code> in the example.</p>
<p>Lets see this <code>super</code> call in action by using it in our <code>process_url/1</code>:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">defp</span> <span class="title">process_url</span></span>(url) <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">case</span> url |&gt; <span class="constant">String.</span>slice(<span class="number">0</span>, <span class="number">8</span>) |&gt; <span class="constant">String.</span>downcase <span class="keyword">do</span></span><br><span class="line">    <span class="string">"http://"</span> &lt;&gt; <span class="constant">_ </span>-&gt; super url</span><br><span class="line">    <span class="string">"https://"</span> &lt;&gt; <span class="constant">_ </span>-&gt; super url</span><br><span class="line">    <span class="constant">_ </span>-&gt; <span class="variable">@endpoint</span> &lt;&gt; url</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>(Read up on the use of the pipe operator, <a href="http://elixir-lang.org/docs/v1.2/elixir/Kernel.html#%7C%3E/2" target="_blank" rel="external">|&gt;</a>, if you’re not familiar with it). Now, both of the following will give us a <code>200</code> status code:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">iex(<span class="number">1</span>)&gt; <span class="constant">Github.Gateway.</span>get! <span class="string">"https://api.github.com/orgs/elixir-lang/repos"</span></span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line">iex(<span class="number">2</span>)&gt; <span class="constant">Github.Gateway.</span>get! <span class="string">"/orgs/elixir-lang/repos"</span></span><br><span class="line"><span class="comment"># ...</span></span><br></pre></td></tr></table></figure>
<p>Of course, the same prefix check is happening in <a href="https://github.com/edgurgel/httpoison/blob/v0.8.0/lib/httpoison/base.ex#L354-L361" target="_blank" rel="external">super</a> in this case, but the point is it works as expected.</p>
<h2 id="Poison"><a href="#Poison" class="headerlink" title="Poison"></a>Poison</h2><p>Moving on to <a href="http://www.json.org/" target="_blank" rel="external">JSON</a> parsing with <a href="https://github.com/devinus/poison" target="_blank" rel="external">Poison</a>. We’re already depending on it so if we <code>iex -S mix</code>, we can start exploring its basic usage (and how to get to specific bits of data):</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">iex(<span class="number">1</span>)&gt; %<span class="constant">HTTPoison.Response&#123;</span> <span class="symbol">body:</span> body &#125; = <span class="constant">Github.Gateway.</span>get! <span class="string">"/orgs/elixir-lang/repos"</span></span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line">iex(<span class="number">2</span>)&gt; i body</span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"><span class="constant">Data </span>type</span><br><span class="line">  <span class="constant">BitString</span></span><br><span class="line"><span class="constant">Byte </span>size</span><br><span class="line">  <span class="number">58284</span></span><br><span class="line"><span class="constant">Description</span></span><br><span class="line">  <span class="constant">This </span>is a <span class="symbol">string:</span> a <span class="constant">UTF-</span><span class="number">8</span> encoded binary. <span class="constant">It'</span>s printed surrounded by</span><br><span class="line">  <span class="string">"double quotes"</span> because all <span class="constant">UTF-</span><span class="number">8</span> encoded codepoints <span class="keyword">in</span> it are printable.</span><br><span class="line">iex(<span class="number">3</span>)&gt; parsed_body = <span class="constant">Poison.Parser.</span>parse! body</span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line">iex(<span class="number">4</span>)&gt; i parsed_body</span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"><span class="constant">Data </span>type</span><br><span class="line">  <span class="constant">List</span></span><br><span class="line">iex(<span class="number">5</span>)&gt; length parsed_body</span><br><span class="line"><span class="number">12</span></span><br><span class="line">iex(<span class="number">6</span>)&gt; parsed_body |&gt; <span class="constant">List.</span>first |&gt; <span class="constant">Map.</span>get(<span class="string">"name"</span>)</span><br><span class="line"><span class="string">"elixir"</span></span><br><span class="line">iex(<span class="number">7</span>)&gt; <span class="symbol">:lists</span>.nth(<span class="number">4</span>, parsed_body)[<span class="string">"name"</span>]</span><br><span class="line"><span class="string">"ex_doc"</span></span><br><span class="line">iex(<span class="number">8</span>)&gt; elixir_repo = parsed_body |&gt; <span class="constant">Enum.</span>at(<span class="number">0</span>)</span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line">iex(<span class="number">9</span>)&gt; i elixir_repo</span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"><span class="constant">Data </span>type</span><br><span class="line">  <span class="constant">Map</span></span><br><span class="line">iex(<span class="number">10</span>)&gt; elixir_repo[<span class="string">"full_name"</span>]</span><br><span class="line"><span class="string">"elixir-lang/elixir"</span></span><br><span class="line">iex(<span class="number">11</span>)&gt; [<span class="constant">_,</span> <span class="constant">_,</span> <span class="constant">_,</span> %&#123; <span class="string">"full_name"</span> =&gt; ex_doc_repo_full_name &#125; | <span class="constant">_]</span> = parsed_body</span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line">iex(<span class="number">12</span>)&gt; ex_doc_repo_full_name</span><br><span class="line"><span class="string">"elixir-lang/ex_doc"</span></span><br></pre></td></tr></table></figure>
<p>I’m digressing a bit here to show off different ways in which you can manipulate the parsed data:</p>
<ul>
<li><code>iex(1)</code> is old news by now, we’ve already seen that we can do this to get the body of our HTTP request.</li>
<li><code>iex(2)</code> is using the <a href="http://elixir-lang.org/docs/v1.2/iex/IEx.Helpers.html#i/1" target="_blank" rel="external">i iex helper function</a> which shows us that <code>body</code> is a BitString.</li>
<li><code>iex(3)</code> is parsing the <code>body</code> with <a href="https://github.com/devinus/poison/blob/1.5.2/lib/poison/parser.ex#L48-L58" target="_blank" rel="external">Poison.Parser.parse!/2</a> and binding the result to <code>parsed_body</code>. Note: For more info on variable naming conventions and the significance of the “trailing bang” in <code>Poison.Parser.parse!</code>, you can read up on these in the <a href="http://elixir-lang.org/docs/master/elixir/naming-conventions.html" target="_blank" rel="external">online doc for naming conventions</a>.</li>
<li><code>iex(5)</code> shows us the length of <code>parsed_body</code> List via the built-in (i.e. imported by default in your modules and <a href="https://github.com/elixir-lang/elixir/blob/v1.2.0/lib/elixir/lib/kernel.ex#L440-L454" target="_blank" rel="external">defined in the Kernel module</a>) <a href="http://elixir-lang.org/docs/v1.2/elixir/Kernel.html#length/1" target="_blank" rel="external">length</a> function.</li>
<li><code>iex(6)</code> is piping to <a href="http://elixir-lang.org/docs/v1.2/elixir/List.html#first/1" target="_blank" rel="external">List.first/1</a> to get the first element in <code>parsed_body</code> and then piping again to <a href="http://elixir-lang.org/docs/v1.2/elixir/Map.html#get/3" target="_blank" rel="external">Map.get/3</a> to get the value for the <code>&quot;name&quot;</code> String key. Note that <code>Map.get/3</code> has an optional 3rd argument (with a default value) and <a href="http://elixir-lang.org/docs/v1.2/elixir/Kernel.html#%7C%3E/2" target="_blank" rel="external">|&gt;</a> is supplying the first argument.</li>
<li><code>iex(7)</code> is similarly getting the value for the <code>&quot;name&quot;</code> String key in the 4th element in <code>parsed_body</code> using <a href="http://www.erlang.org/doc/man/lists.html#nth-2" target="_blank" rel="external">Erlang’s lists:nth/2</a> function. Note that we cannot pipe <code>parsed_body</code> into this function as it takes the index for its first argument (as opposed to the List). Also note that the index for <code>lists:nth/2</code> starts from 1 not 0.</li>
<li><code>iex(8)</code> demonstrates another way of picking elements from a list using <a href="http://elixir-lang.org/docs/v1.2/elixir/Enum.html#at/3" target="_blank" rel="external">Enum.at/3</a>.</li>
<li><code>iex(11)</code> uses <a href="http://elixir-lang.org/getting-started/pattern-matching.html" target="_blank" rel="external">pattern matching</a> to get to the value of the <code>&quot;full_name&quot;</code> key in the Map which is the 4th element in the <code>parsed_body</code> List.</li>
</ul>
<p>So we’ve parsed some JSON into a list of maps and singled out bits of data from it. We’re now ready to write that data back out, or “encode” it back to JSON:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">iex(13)&gt; Poison.encode(elixir_repo)</span><br><span class="line">&#123;:ok,</span><br><span class="line">"&#123;\"teams_url\":\"https://api.github.com/repos/elixir-lang/elixir/teams\",</span><br><span class="line"># ...</span><br><span class="line">iex(14)&gt; elem(Poison.encode(elixir_repo), 1)</span><br><span class="line">"&#123;\"teams_url\":\"https://api.github.com/repos/elixir-lang/elixir/teams\",</span><br><span class="line"># ...</span><br><span class="line">iex(15)&gt; IO.puts elem(Poison.encode(elixir_repo), 1)</span><br><span class="line">&#123;"teams_url":"https://api.github.com/repos/elixir-lang/elixir/teams",</span><br><span class="line"># ...</span><br><span class="line">iex(16)&gt; IO.puts elem(Poison.encode(elixir_repo, [pretty: 2]), 1)</span><br><span class="line">&#123;</span><br><span class="line">  "teams_url": "https://api.github.com/repos/elixir-lang/elixir/teams",</span><br><span class="line">  "branches_url": "https://api.github.com/repos/elixir-lang/elixir/branches&#123;/branch&#125;",</span><br><span class="line"># ...</span><br><span class="line">iex(17)&gt; File.write("./elixir_repo.json", elem(Poison.encode(elixir_repo, [pretty: 2]), 1))</span><br><span class="line">:ok</span><br><span class="line">iex(18)&gt; elixir_repo |&gt; Poison.encode([pretty: 2]) |&gt; elem(1) |&gt; IO.puts</span><br><span class="line"># ... same as iex(16)</span><br></pre></td></tr></table></figure>
<ul>
<li><code>iex(13)</code> uses <a href="https://github.com/devinus/poison/blob/master/lib/poison.ex#L6-L19" target="_blank" rel="external">Poison.encode/2</a> without <code>options</code> (thus defaulting to an empty List) to encode the <code>elixir_repo</code> Map to JSON. This returns a tuple with <code>:ok</code> as the first element and the encoded JSON as the second.</li>
<li><code>iex(14)</code> uses <a href="http://elixir-lang.org/docs/v1.2/elixir/Kernel.html#elem/2" target="_blank" rel="external">elem/2</a> to extract the JSON from the tuple.</li>
<li><code>iex(15)</code> prints <code>iex(14)</code> to stdout.</li>
<li><code>iex(16)</code> uses the <code>[pretty: 2]</code> <a href="https://github.com/devinus/poison/blob/1.5.2/lib/poison/encoder.ex#L31-L60" target="_blank" rel="external">option</a> when encoding to print the JSON in a more readable fashion.</li>
<li><code>iex(17)</code> does the same thing but writes to the <code>&quot;./elixir_repo.json&quot;</code> file instead of stdout.</li>
<li><code>iex(18)</code> is just <code>iex(16)</code> using pipes.</li>
</ul>
<p>While we’re at it, and since we have a large enough Map to demo it, consider the following:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">iex(<span class="number">19</span>)&gt; <span class="constant">Map.</span>keys elixir_repo</span><br><span class="line">[<span class="string">"statuses_url"</span>, <span class="string">"git_refs_url"</span>, <span class="string">"issue_comment_url"</span>, <span class="string">"watchers"</span>, <span class="string">"mirror_url"</span>,</span><br><span class="line"> <span class="string">"languages_url"</span>, <span class="string">"stargazers_count"</span>, <span class="string">"forks"</span>, <span class="string">"default_branch"</span>, <span class="string">"comments_url"</span>,</span><br><span class="line"> <span class="string">"commits_url"</span>, <span class="string">"id"</span>, <span class="string">"clone_url"</span>, <span class="string">"homepage"</span>, <span class="string">"stargazers_url"</span>, <span class="string">"events_url"</span>,</span><br><span class="line"> <span class="string">"blobs_url"</span>, <span class="string">"forks_count"</span>, <span class="string">"pushed_at"</span>, <span class="string">"git_url"</span>, <span class="string">"hooks_url"</span>, <span class="string">"owner"</span>,</span><br><span class="line"> <span class="string">"trees_url"</span>, <span class="string">"git_commits_url"</span>, <span class="string">"collaborators_url"</span>, <span class="string">"watchers_count"</span>,</span><br><span class="line"> <span class="string">"tags_url"</span>, <span class="string">"merges_url"</span>, <span class="string">"releases_url"</span>, <span class="string">"subscribers_url"</span>, <span class="string">"ssh_url"</span>,</span><br><span class="line"> <span class="string">"created_at"</span>, <span class="string">"name"</span>, <span class="string">"has_issues"</span>, <span class="string">"private"</span>, <span class="string">"git_tags_url"</span>, <span class="string">"archive_url"</span>,</span><br><span class="line"> <span class="string">"has_wiki"</span>, <span class="string">"open_issues_count"</span>, <span class="string">"milestones_url"</span>, <span class="string">"forks_url"</span>, <span class="string">"url"</span>,</span><br><span class="line"> <span class="string">"downloads_url"</span>, <span class="string">"open_issues"</span>, <span class="string">"keys_url"</span>, <span class="string">"description"</span>, <span class="string">"contents_url"</span>,</span><br><span class="line"> <span class="string">"language"</span>, <span class="string">"permissions"</span>, <span class="string">"contributors_url"</span>, ...]</span><br><span class="line">iex(<span class="number">20</span>)&gt; elixir_repo |&gt; <span class="constant">Map.</span>keys |&gt; length</span><br><span class="line"><span class="number">68</span></span><br><span class="line">iex(<span class="number">21</span>)&gt; <span class="constant">Inspect.Opts.__struct__</span></span><br><span class="line">%<span class="constant">Inspect.Opts&#123;</span><span class="symbol">base:</span> <span class="symbol">:decimal</span>, <span class="symbol">binaries:</span> <span class="symbol">:infer</span>, <span class="symbol">char_lists:</span> <span class="symbol">:infer</span>, <span class="symbol">limit:</span> <span class="number">50</span>,</span><br><span class="line"> <span class="symbol">pretty:</span> <span class="keyword">false</span>, <span class="symbol">safe:</span> <span class="keyword">true</span>, <span class="symbol">structs:</span> <span class="keyword">true</span>, <span class="symbol">width:</span> <span class="number">80</span>&#125;</span><br><span class="line">iex(<span class="number">22</span>)&gt; <span class="constant">Inspect.Opts.__struct__.</span>limit</span><br><span class="line"><span class="number">50</span></span><br><span class="line">iex(<span class="number">23</span>)&gt; elixir_repo |&gt; <span class="constant">Map.</span>keys |&gt; <span class="constant">Enum.</span>take(<span class="number">50</span>)</span><br><span class="line">[<span class="string">"statuses_url"</span>, <span class="string">"git_refs_url"</span>, <span class="string">"issue_comment_url"</span>, <span class="string">"watchers"</span>, <span class="string">"mirror_url"</span>,</span><br><span class="line"> <span class="string">"languages_url"</span>, <span class="string">"stargazers_count"</span>, <span class="string">"forks"</span>, <span class="string">"default_branch"</span>, <span class="string">"comments_url"</span>,</span><br><span class="line"> <span class="string">"commits_url"</span>, <span class="string">"id"</span>, <span class="string">"clone_url"</span>, <span class="string">"homepage"</span>, <span class="string">"stargazers_url"</span>, <span class="string">"events_url"</span>,</span><br><span class="line"> <span class="string">"blobs_url"</span>, <span class="string">"forks_count"</span>, <span class="string">"pushed_at"</span>, <span class="string">"git_url"</span>, <span class="string">"hooks_url"</span>, <span class="string">"owner"</span>,</span><br><span class="line"> <span class="string">"trees_url"</span>, <span class="string">"git_commits_url"</span>, <span class="string">"collaborators_url"</span>, <span class="string">"watchers_count"</span>,</span><br><span class="line"> <span class="string">"tags_url"</span>, <span class="string">"merges_url"</span>, <span class="string">"releases_url"</span>, <span class="string">"subscribers_url"</span>, <span class="string">"ssh_url"</span>,</span><br><span class="line"> <span class="string">"created_at"</span>, <span class="string">"name"</span>, <span class="string">"has_issues"</span>, <span class="string">"private"</span>, <span class="string">"git_tags_url"</span>, <span class="string">"archive_url"</span>,</span><br><span class="line"> <span class="string">"has_wiki"</span>, <span class="string">"open_issues_count"</span>, <span class="string">"milestones_url"</span>, <span class="string">"forks_url"</span>, <span class="string">"url"</span>,</span><br><span class="line"> <span class="string">"downloads_url"</span>, <span class="string">"open_issues"</span>, <span class="string">"keys_url"</span>, <span class="string">"description"</span>, <span class="string">"contents_url"</span>,</span><br><span class="line"> <span class="string">"language"</span>, <span class="string">"permissions"</span>, <span class="string">"contributors_url"</span>]</span><br><span class="line">iex(<span class="number">24</span>)&gt; <span class="constant">IEx.</span>configure(<span class="symbol">inspect:</span> [<span class="symbol">limit:</span> <span class="number">70</span>])</span><br><span class="line"><span class="symbol">:ok</span></span><br><span class="line">iex(<span class="number">25</span>)&gt; <span class="constant">Map.</span>keys elixir_repo</span><br><span class="line">[<span class="string">"statuses_url"</span>, <span class="string">"git_refs_url"</span>, <span class="string">"issue_comment_url"</span>, <span class="string">"watchers"</span>, <span class="string">"mirror_url"</span>,</span><br><span class="line"> <span class="string">"languages_url"</span>, <span class="string">"stargazers_count"</span>, <span class="string">"forks"</span>, <span class="string">"default_branch"</span>, <span class="string">"comments_url"</span>,</span><br><span class="line"> <span class="string">"commits_url"</span>, <span class="string">"id"</span>, <span class="string">"clone_url"</span>, <span class="string">"homepage"</span>, <span class="string">"stargazers_url"</span>, <span class="string">"events_url"</span>,</span><br><span class="line"> <span class="string">"blobs_url"</span>, <span class="string">"forks_count"</span>, <span class="string">"pushed_at"</span>, <span class="string">"git_url"</span>, <span class="string">"hooks_url"</span>, <span class="string">"owner"</span>,</span><br><span class="line"> <span class="string">"trees_url"</span>, <span class="string">"git_commits_url"</span>, <span class="string">"collaborators_url"</span>, <span class="string">"watchers_count"</span>,</span><br><span class="line"> <span class="string">"tags_url"</span>, <span class="string">"merges_url"</span>, <span class="string">"releases_url"</span>, <span class="string">"subscribers_url"</span>, <span class="string">"ssh_url"</span>,</span><br><span class="line"> <span class="string">"created_at"</span>, <span class="string">"name"</span>, <span class="string">"has_issues"</span>, <span class="string">"private"</span>, <span class="string">"git_tags_url"</span>, <span class="string">"archive_url"</span>,</span><br><span class="line"> <span class="string">"has_wiki"</span>, <span class="string">"open_issues_count"</span>, <span class="string">"milestones_url"</span>, <span class="string">"forks_url"</span>, <span class="string">"url"</span>,</span><br><span class="line"> <span class="string">"downloads_url"</span>, <span class="string">"open_issues"</span>, <span class="string">"keys_url"</span>, <span class="string">"description"</span>, <span class="string">"contents_url"</span>,</span><br><span class="line"> <span class="string">"language"</span>, <span class="string">"permissions"</span>, <span class="string">"contributors_url"</span>, <span class="string">"pulls_url"</span>, <span class="string">"labels_url"</span>,</span><br><span class="line"> <span class="string">"html_url"</span>, <span class="string">"svn_url"</span>, <span class="string">"issue_events_url"</span>, <span class="string">"notifications_url"</span>,</span><br><span class="line"> <span class="string">"has_downloads"</span>, <span class="string">"compare_url"</span>, <span class="string">"full_name"</span>, <span class="string">"subscription_url"</span>,</span><br><span class="line"> <span class="string">"assignees_url"</span>, <span class="string">"issues_url"</span>, <span class="string">"size"</span>, <span class="string">"has_pages"</span>, <span class="string">"fork"</span>, <span class="string">"updated_at"</span>,</span><br><span class="line"> <span class="string">"branches_url"</span>, <span class="string">"teams_url"</span>]</span><br></pre></td></tr></table></figure>
<ul>
<li><code>iex(19)</code> prints out the keys in the <code>elixir_repo</code> Map - but note the trailing ellipsis after the <code>&quot;contributors_url&quot;</code> key, i.e. the shell doesn’t print all the keys since it is configured to print up to a limit of number of elements for certain data types, such as lists in this case.</li>
<li><code>iex(20)</code> shows us how many keys the <code>elixir_repo</code> Map has (68).</li>
<li><code>iex(21)</code> shows the current settings of <a href="http://elixir-lang.org/docs/v1.2/elixir/Inspect.Opts.html" target="_blank" rel="external">Inspect.Opts</a> which are used by the shell when inspecting values (and “inspecting values” is used when printing our expression results to the shell - and also, for e.g., when using the <code>i</code> helper).</li>
<li><code>iex(22)</code> highlights the setting we’re currently interested in, the <code>:limit</code> field:</li>
</ul>
<blockquote>:limit - limits the number of items that are printed for tuples, bitstrings, and lists, does not apply to strings nor char lists, defaults to 50.<footer><cite><a href="http://elixir-lang.org/docs/v1.2/elixir/Inspect.Opts.html" target="_blank" rel="external">Inspect.Opts doc</a></cite></footer></blockquote>

<ul>
<li><code>iex(23)</code> just shows that if we take 50 from the List of keys, we do indeed end up with all the keys printed in <code>iex(19)</code> (no ellipsis).</li>
<li><code>iex(24)</code> is setting the inspection limit to 70 (by supplying a <a href="http://elixir-lang.org/getting-started/maps-and-dicts.html#keyword-lists" target="_blank" rel="external">keyword list</a> argument). More specifically, it is setting the IEx configuration for inspection via the <code>:inspect</code> keyword list element, whose value takes yet another keyword list made up of the <a href="http://elixir-lang.org/docs/v1.2/elixir/Inspect.Opts.html" target="_blank" rel="external">Inspect.Opts</a> fields we’ve just seen:</li>
</ul>
<blockquote>A keyword list containing inspect options used by the shell when printing results of expression evaluation. Default to pretty formatting with a limit of 50 entries.<br>See <a href="http://elixir-lang.org/docs/v1.2/elixir/Inspect.Opts.html" target="_blank" rel="external">Inspect.Opts</a> for the full list of options.<br><footer><cite><a href="http://elixir-lang.org/docs/stable/iex/IEx.html#configure/1" target="_blank" rel="external">IEx.configure/1 :inspect option</a></cite></footer></blockquote>

<ul>
<li><code>iex(25)</code> shows the result of this configuration. We are now able to print out all 68 keys.</li>
</ul>
<p>You might want to read <a href="http://elixir-lang.org/docs/stable/iex/IEx.html" target="_blank" rel="external">The .iex.exs file</a> section in the IEx docs if you’re interested in setting IEx configuration on shell startup (or just setting up IEx with pre-bound variables etc…). Kudos to <a href="https://groups.google.com/forum/?utm_medium=email&amp;utm_source=footer#!topic/elixir-lang-talk/2wQOc5S0z1o" target="_blank" rel="external">Gary Rennie</a> for helping me find this when I was first looking for it.</p>
<h1 id="Building-an-API-with-Streams"><a href="#Building-an-API-with-Streams" class="headerlink" title="Building an API with Streams"></a>Building an API with Streams</h1><p>Back to our “intention” here. With all this background you should now be better equipped to digest most of the code in Drew’s original post. However, the <code>Github.ResultStream</code> module below is worth breaking down as it features a couple of things we haven’t yet discussed:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># lib/github_resultstream.ex</span></span><br><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">Github</span></span>.<span class="constant">ResultStream </span><span class="keyword">do</span></span><br><span class="line">  <span class="keyword">alias</span> <span class="constant">Github.Gateway</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">new</span></span>(url) <span class="keyword">do</span></span><br><span class="line">    <span class="constant">Stream.</span>resource(</span><br><span class="line">      <span class="keyword">fn</span> -&gt; fetch_page(url) <span class="keyword">end</span>,</span><br><span class="line">      &amp;process_page/<span class="number">1</span>,</span><br><span class="line">      <span class="keyword">fn</span> <span class="constant">_ </span>-&gt; <span class="keyword">nil</span> <span class="keyword">end</span></span><br><span class="line">    )</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">defp</span> <span class="title">fetch_page</span></span>(url) <span class="keyword">do</span></span><br><span class="line">    response = <span class="constant">Gateway.</span>get!(url)</span><br><span class="line">    items = <span class="constant">Poison.</span>decode!(response.body)</span><br><span class="line">    <span class="comment"># <span class="doctag">TODO:</span> fix access to "Link" header</span></span><br><span class="line">    <span class="comment"># Works "by accident" in v1.1 of Elixir</span></span><br><span class="line">    <span class="comment"># Fixed (i.e. doesn't work) in v1.2:</span></span><br><span class="line">    links = parse_links(response.headers[<span class="string">"Link"</span>])</span><br><span class="line"></span><br><span class="line">    &#123;items, links[<span class="string">"next"</span>]&#125;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">parse_links</span></span>(<span class="keyword">nil</span>) <span class="keyword">do</span></span><br><span class="line">    %&#123;&#125;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">parse_links</span></span>(links_string) <span class="keyword">do</span></span><br><span class="line">    links = <span class="constant">String.</span>split(links_string, <span class="string">", "</span>)</span><br><span class="line"></span><br><span class="line">    <span class="constant">Enum.</span>map(links, <span class="keyword">fn</span> link -&gt;</span><br><span class="line">      [<span class="constant">_,</span>name] = <span class="constant">Regex.</span>run(~r&#123;rel=<span class="string">"([a-z]+)"</span>&#125;, link)</span><br><span class="line">      [<span class="constant">_,</span>url] = <span class="constant">Regex.</span>run(~r&#123;&lt;([^&gt;]+)&gt;&#125;, link)</span><br><span class="line">      short_url = <span class="constant">String.</span>replace(url, <span class="constant">Gateway.</span>endpoint, <span class="string">""</span>)</span><br><span class="line"></span><br><span class="line">      &#123;name, short_url&#125;</span><br><span class="line">    <span class="keyword">end</span>) |&gt; <span class="constant">Enum.</span>into(%&#123;&#125;)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">defp</span> <span class="title">process_page</span></span>(&#123;<span class="keyword">nil</span>, <span class="keyword">nil</span>&#125;) <span class="keyword">do</span></span><br><span class="line">    &#123;<span class="symbol">:halt</span>, <span class="keyword">nil</span>&#125;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">defp</span> <span class="title">process_page</span></span>(&#123;<span class="keyword">nil</span>, next_page_url&#125;) <span class="keyword">do</span></span><br><span class="line">    next_page_url</span><br><span class="line">    |&gt; fetch_page</span><br><span class="line">    |&gt; process_page</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">defp</span> <span class="title">process_page</span></span>(&#123;items, next_page_url&#125;) <span class="keyword">do</span></span><br><span class="line">    &#123;items, &#123;<span class="keyword">nil</span>, next_page_url&#125;&#125;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<h2 id="Stream-resource-3"><a href="#Stream-resource-3" class="headerlink" title="Stream.resource/3"></a><a href="http://elixir-lang.org/docs/v1.2/elixir/Stream.html#resource/3" target="_blank" rel="external">Stream.resource/3</a></h2><p>To make sense of this, it’s probably best to just jump straight to the example given in the online docs:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Stream.resource(start_fun, next_fun, after_fun)</span></span><br><span class="line"><span class="comment"># @spec resource((() -&gt; acc), (acc -&gt; &#123;element, acc&#125; | &#123;:halt, acc&#125;), (acc -&gt; term)) :: Enumerable.t</span></span><br><span class="line"><span class="constant">Stream.</span>resource(<span class="keyword">fn</span> -&gt; <span class="constant">File.</span>open!(<span class="string">"sample"</span>) <span class="keyword">end</span>,</span><br><span class="line">                <span class="keyword">fn</span> file -&gt;</span><br><span class="line">                  <span class="keyword">case</span> <span class="constant">IO.</span>read(file, <span class="symbol">:line</span>) <span class="keyword">do</span></span><br><span class="line">                    data <span class="keyword">when</span> is_binary(data) -&gt; &#123;[data], file&#125;</span><br><span class="line">                    <span class="constant">_ </span>-&gt; &#123;<span class="symbol">:halt</span>, file&#125;</span><br><span class="line">                  <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">end</span>,</span><br><span class="line">                <span class="keyword">fn</span> file -&gt; <span class="constant">File.</span>close(file) <span class="keyword">end</span>)</span><br></pre></td></tr></table></figure>
<p>So <code>Stream.resource/3</code> takes 3 functions, <code>start_fun</code>, <code>next_fun</code>, and <code>after_fun</code>.</p>
<p>The result of <code>start_fun</code> is fed as an argument to <code>next_fun</code> which is responsible for generating the stream’s values. In this case, that result is a <a href="http://elixir-lang.org/getting-started/processes.html" target="_blank" rel="external">process</a> id (or PID):</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># we're using the file we wrote in iex(17) above</span></span><br><span class="line">iex(<span class="number">26</span>)&gt; <span class="constant">File.</span>open!(<span class="string">"./elixir_repo.json"</span>)</span><br><span class="line"><span class="comment">#PID&lt;0.64.0&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>Every time a file is opened, Elixir spawns a new process.<footer><cite><a href="http://elixir-lang.org/docs/v1.2/elixir/File.html" target="_blank" rel="external">File module doc</a></cite></footer></blockquote>

<p>Note that the result of <a href="http://elixir-lang.org/docs/v1.2/elixir/File.html#open!/2" target="_blank" rel="external">File.open!/2</a> is different from that of <a href="http://elixir-lang.org/docs/v1.2/elixir/File.html#open/2" target="_blank" rel="external">File.open/2</a> (also note that the second arg is optional in both cases):</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iex(<span class="number">27</span>)&gt; <span class="constant">File.</span>open(<span class="string">"./elixir_repo.json"</span>)</span><br><span class="line">&#123;<span class="symbol">:ok</span>, <span class="comment">#PID&lt;0.66.0&gt;&#125;</span></span><br></pre></td></tr></table></figure>
<p>i.e. it’s wrapped in a tuple. You can read up on this in the “Trailing bang” section in the <a href="http://elixir-lang.org/docs/master/elixir/naming-conventions.html" target="_blank" rel="external">naming conventions</a> doc. The <a href="http://elixir-lang.org/docs/v1.2/elixir/File.html" target="_blank" rel="external">File module</a>‘s doc also mentions this in the “API” section.</p>
<p>This PID is called an <code>io_device</code> in the doc for the File module, and an <code>io_device</code> can be used as an argument to the <a href="http://elixir-lang.org/docs/v1.2/elixir/IO.html" target="_blank" rel="external">IO module</a> functions.</p>
<p>That is exactly what’s happening in <code>next_fun</code> above, which is passing <code>file</code> (bound to a PID), to <a href="http://elixir-lang.org/docs/v1.2/elixir/IO.html#read/2" target="_blank" rel="external">IO.read/2</a> to read a line from the <code>io_device</code>:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">iex(<span class="number">28</span>)&gt; file = v(<span class="number">26</span>)</span><br><span class="line"><span class="comment">#PID&lt;0.64.0&gt;</span></span><br><span class="line">iex(<span class="number">29</span>)&gt; <span class="constant">IO.</span>read(file, <span class="symbol">:line</span>)</span><br><span class="line"><span class="string">"&#123;\n"</span></span><br><span class="line">iex(<span class="number">30</span>)&gt; <span class="constant">IO.</span>read(file, <span class="symbol">:line</span>)</span><br><span class="line"><span class="string">"  \"teams_url\": \"https://api.github.com/repos/elixir-lang/elixir/teams\",\n"</span></span><br><span class="line">iex(<span class="number">31</span>)&gt; <span class="constant">IO.</span>read(file, <span class="symbol">:line</span>)</span><br><span class="line"><span class="string">"  \"branches_url\": \"https://api.github.com/repos/elixir-lang/elixir/branches&#123;/branch&#125;\",\n"</span></span><br><span class="line">iex(<span class="number">32</span>)&gt; is_binary <span class="constant">IO.</span>read(file, <span class="symbol">:line</span>)</span><br><span class="line"><span class="keyword">true</span></span><br></pre></td></tr></table></figure>
<p>With the <code>:line</code> option, <code>IO.read/2</code> will keep giving us binary data until we read the whole file, at which point it will return an <code>:eof</code> atom which will match our second clause in our <code>next_fun</code>‘s <code>case</code> expression. So from this we can see that <code>next_fun</code> either returns <code>{[data], file}</code> or <code>{:halt, file}</code> - i.e. either the next line in the file as a string wrapped in a list or <code>:halt</code> to mark the end of the stream, in both cases accompanied by <code>file</code> our accumulator (the thing by which we’re able to keep streaming values).</p>
<blockquote>Successive values are generated by calling <code>next_fun</code> with the previous accumulator (the initial value being the result returned by <code>start_fun</code>) and it must return a tuple containing a <strong>list of items</strong> to be emitted and the next accumulator.<br><br><footer>Why do we wrap the read line in a list?<cite><a href="http://elixir-lang.org/docs/v1.2/elixir/Stream.html#resource/3" target="_blank" rel="external">Stream.resource/3 doc</a></cite></footer></blockquote>

<p>Finally, the <code>after_fun</code> is called with the accumulator (<code>file</code>) in order to give us an opportunity to clean up after ourselves, in this case, closing the file.</p>
<p>With that, we now know the control flow abstracted by <code>Stream.resource/3</code>. If we take another look at it’s usage in <code>Github.ResultStream</code>:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">new</span></span>(url) <span class="keyword">do</span></span><br><span class="line">  <span class="constant">Stream.</span>resource(</span><br><span class="line">    <span class="keyword">fn</span> -&gt; fetch_page(url) <span class="keyword">end</span>,</span><br><span class="line">    &amp;process_page/<span class="number">1</span>,</span><br><span class="line">    <span class="keyword">fn</span> <span class="constant">_ </span>-&gt; <span class="keyword">nil</span> <span class="keyword">end</span></span><br><span class="line">  )</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>the other things to note before diving into the meat of its implementation (<code>process_page/1</code>), are the use of <a href="http://elixir-lang.org/crash-course.html#partials-in-elixir" target="_blank" rel="external">Elixir partials</a> to refer to <code>process_page/1</code> to act as <code>Stream.resource/3</code>‘s <code>next_fun</code>, and the definition of a “do nothing” function for the <code>after_fun</code> (since we have nothing to clean up). Originally, the “do nothing” function was defined as: <code>fn _ -&gt; end</code> in Drew’s post but the compiler gives a warning for this syntax as of Elixir 1.2, so we need to evaluate to <code>nil</code> (which is what used to happen anyway when no expression was given). Kudos to <a href="https://groups.google.com/forum/?utm_medium=email&amp;utm_source=footer#!msg/elixir-lang-talk/CQcWAkbmg9o/jkDq2_h8DAAJ" target="_blank" rel="external">René Föhring</a> for pointing this out.</p>
<blockquote>[Kernel] Warn when right hand side of -&gt; does not provide any expression<footer><cite><a href="https://github.com/elixir-lang/elixir/releases/tag/v1.2.0" target="_blank" rel="external">v1.2.0 release notes</a></cite></footer></blockquote>

<h2 id="The-rest-of-Github-ResultStream"><a href="#The-rest-of-Github-ResultStream" class="headerlink" title="The rest of Github.ResultStream"></a>The rest of Github.ResultStream</h2><p>We’re good to move on… so let’s tackle the “TODO” comment in the snippet below:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">defp</span> <span class="title">fetch_page</span></span>(url) <span class="keyword">do</span></span><br><span class="line">  response = <span class="constant">Gateway.</span>get!(url)</span><br><span class="line">  items = <span class="constant">Poison.</span>decode!(response.body)</span><br><span class="line">  <span class="comment"># <span class="doctag">TODO:</span> fix access to "Link" header</span></span><br><span class="line">  <span class="comment"># Works "by accident" in v1.1 of Elixir</span></span><br><span class="line">  <span class="comment"># Fixed (i.e. doesn't work) in v1.2:</span></span><br><span class="line">  links = parse_links(response.headers[<span class="string">"Link"</span>])</span><br><span class="line"></span><br><span class="line">  &#123;items, links[<span class="string">"next"</span>]&#125;</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>Back when I was going through Drew’s post I was using Elixir v1.1.1 (there was no v1.2 yet). Lets try the following with v1.1.1:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">iex(<span class="number">1</span>)&gt; headers = [&#123;<span class="string">"Server"</span>, <span class="string">"GitHub.com"</span>&#125;]</span><br><span class="line">[&#123;<span class="string">"Server"</span>, <span class="string">"GitHub.com"</span>&#125;]</span><br><span class="line">iex(<span class="number">2</span>)&gt; headers[<span class="string">"Server"</span>]</span><br><span class="line"><span class="string">"GitHub.com"</span></span><br></pre></td></tr></table></figure>
<p>When I started writing this post (a couple of days before the beginning of the year), v1.2 came out so I switched to the new hotness. Running the same thing in v1.2 gives:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">iex(<span class="number">1</span>)&gt; headers = [&#123;<span class="string">"Server"</span>, <span class="string">"GitHub.com"</span>&#125;]</span><br><span class="line">[&#123;<span class="string">"Server"</span>, <span class="string">"GitHub.com"</span>&#125;]</span><br><span class="line">iex(<span class="number">2</span>)&gt; headers[<span class="string">"Server"</span>]</span><br><span class="line">** (<span class="constant">ArgumentError)</span> the <span class="constant">Access </span>calls <span class="keyword">for</span> keywords expect the key to be an atom, <span class="symbol">got:</span> <span class="string">"Server"</span></span><br><span class="line">    (elixir) lib/access.<span class="symbol">ex:</span><span class="number">64</span><span class="symbol">:</span> <span class="constant">Access.</span>fetch/<span class="number">2</span></span><br><span class="line">    (elixir) lib/access.<span class="symbol">ex:</span><span class="number">77</span><span class="symbol">:</span> <span class="constant">Access.</span>get/<span class="number">3</span></span><br></pre></td></tr></table></figure>
<p>At first, I thought something was broken in v1.2 but as <a href="https://groups.google.com/forum/?utm_medium=email&amp;utm_source=footer#!msg/elixir-lang-talk/Ydx4E_bmAP8/bugKvIg5EwAJ" target="_blank" rel="external">José Valim</a> points out, it looks like the behaviour in v1.1.1 was accidental! You can’t use that syntax on <code>headers</code> in this case because <code>headers</code> isn’t a keyword list or map. It’s a list of 2-element tuples but the first element in the tuple is not an atom (which would make it a keyword list) so this syntax won’t work. I thought I’d leave this bit in as I guess it’s “good to know”.</p>
<p>So we’re going to have to extract the “Link” header in some other way, which is just as well as it gives us the opportunity to look at a nice little trick I picked up from the blog post <a href="http://blog.plataformatec.com.br/2014/09/writing-assertive-code-with-elixir/" target="_blank" rel="external">Writing assertive code with Elixir</a> by <a href="https://twitter.com/josevalim?ref_src=twsrc%5Egoogle%7Ctwcamp%5Eserp%7Ctwgr%5Eauthor" target="_blank" rel="external">José Valim</a>:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">defp</span> <span class="title">fetch_page</span></span>(url) <span class="keyword">do</span></span><br><span class="line">  response = <span class="constant">Gateway.</span>get!(url)</span><br><span class="line">  items = <span class="constant">Poison.</span>decode!(response.body)</span><br><span class="line">  links_map = </span><br><span class="line">    response.headers</span><br><span class="line">    |&gt; <span class="constant">Enum.</span>find_value(<span class="keyword">fn</span>(&#123;k, v&#125;) -&gt; k == <span class="string">"Link"</span> &amp;&amp; v <span class="keyword">end</span>)</span><br><span class="line">    |&gt; parse_links</span><br><span class="line">  &#123;items, links_map[<span class="string">"next"</span>]&#125;</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>First off, note the behaviour of the following:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">iex(<span class="number">1</span>)&gt; <span class="keyword">true</span> &amp;&amp; <span class="string">"hello"</span></span><br><span class="line"><span class="string">"hello"</span></span><br><span class="line">iex(<span class="number">2</span>)&gt; <span class="string">"hello"</span> &amp;&amp; <span class="keyword">true</span></span><br><span class="line"><span class="keyword">true</span></span><br><span class="line">iex(<span class="number">3</span>)&gt; <span class="keyword">false</span> &amp;&amp; <span class="string">"hello"</span></span><br><span class="line"><span class="keyword">false</span></span><br><span class="line">iex(<span class="number">4</span>)&gt; <span class="string">"hello"</span> &amp;&amp; <span class="keyword">false</span></span><br><span class="line"><span class="keyword">false</span></span><br><span class="line">iex(<span class="number">5</span>)&gt; <span class="string">"hello"</span> &amp;&amp; <span class="string">"world"</span></span><br><span class="line"><span class="string">"world"</span></span><br></pre></td></tr></table></figure>
<blockquote>Provides a short-circuit operator that evaluates and returns the second expression only if the first one evaluates to true (i.e., it is not nil nor false). Returns the first expression otherwise.<footer><cite><a href="http://elixir-lang.org/docs/v1.2/elixir/Kernel.html#&&/2" target="_blank" rel="external">Kernel.&amp;&amp;/2 macro doc</a></cite></footer></blockquote>

<p>This means that whenever <code>k == &quot;Link&quot;</code> evaluates to <code>false</code>, <code>k == &quot;Link&quot; &amp;&amp; v</code> will always evaluate to <code>false</code>. Should it ever evaluate to <code>true</code>, then <code>k == &quot;Link&quot; &amp;&amp; v</code> would evaluate to <code>v</code></p>
<p><a href="http://elixir-lang.org/docs/v1.2/elixir/Enum.html#find_value/3" target="_blank" rel="external">Enum.find_value/3</a> is similar to <a href="http://elixir-lang.org/docs/v1.2/elixir/Enum.html#find/3" target="_blank" rel="external">Enum.find/3</a>, which I assume you’re already familiar with. The only difference is that instead of returning the element in the enumerable (list) for which the function you pass in evaluates to “not <code>false</code> or <code>nil</code>“, <code>Enum.find_value/3</code> returns the function’s “truthy” value instead (where “truthy” is “not <code>false</code> or <code>nil</code>“).</p>
<p>(One gotcha that comes to mind would be if, for e.g., the list we’re querying has something like {“Link”, nil}. Since <code>nil</code> is also <code>Enum.find_value/3</code>‘s default return value if the function you pass in never evaluates to truthy, you wouldn’t be able to tell if the <code>nil</code> you get back from <code>find_value/3</code> was a match or not).</p>
<p>This works well for our use case. Another approach suggested by <a href="https://groups.google.com/forum/#!msg/elixir-lang-talk/Ydx4E_bmAP8/A-LixvVmEwAJ" target="_blank" rel="external">Michał Muskała</a> uses <a href="http://elixir-lang.org/docs/v1.2/elixir/List.html#keyfind/4" target="_blank" rel="external">List.keyfind/4</a> and works just as well:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">defp</span> <span class="title">fetch_page</span></span>(url) <span class="keyword">do</span></span><br><span class="line">  response = <span class="constant">Gateway.</span>get!(url)</span><br><span class="line">  items = <span class="constant">Poison.</span>decode!(response.body)</span><br><span class="line">  links_map = </span><br><span class="line">    response.headers</span><br><span class="line">    |&gt; <span class="constant">List.</span>keyfind(<span class="string">"Link"</span>, <span class="number">0</span>, &#123;<span class="keyword">nil</span>, <span class="keyword">nil</span>&#125;)</span><br><span class="line">    |&gt; elem(<span class="number">1</span>)</span><br><span class="line">    |&gt; parse_links</span><br><span class="line">  &#123;items, links_map[<span class="string">"next"</span>]&#125;</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>I wanted to mention it anyway because it’s “good to know” the functions in the standard lib. For e.g. before finding out about <code>List.keyfind/4</code>, I would use <code>Enum.find/3</code> but the former has a simpler API if you’re working with a list of tuples.</p>
<p>However, note that to get the same behaviour, you need to default to something like <code>{nil, nil}</code> in our case because if <code>List.keyfind/4</code> doesn’t find the key and returns <code>nil</code> (by default), then <a href="http://elixir-lang.org/docs/master/elixir/Kernel.html#elem/2" target="_blank" rel="external">elem/2</a> will throw an exception. We need to use <code>elem/2</code> to get the value part of the “Link” header in this case as <code>List.keyfind/4</code> gives us back the whole tuple.</p>
<p>So I’ll stick to <code>Enum.find_value/3</code> for this case. You might want to read that Google Group thread for another interesting approach suggested by <a href="https://groups.google.com/forum/?utm_medium=email&amp;utm_source=footer#!msg/elixir-lang-talk/Ydx4E_bmAP8/OVgPBHx1EwAJ" target="_blank" rel="external">Ben Wilson</a> which caters for multiple similar “keys” (i.e. first element of tuple) in the list. In our case, we know we’ll only have at most one “Link” header (possibly none), so it’s best not to use that approach here as the code would be longer (in both converting to a map and accessing the “Link” key which might not be there, and whose value would then be a list if it were there).</p>
<p>Ok ok… back on track:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  defp fetch_page(url) do</span></span><br><span class="line"><span class="comment">#    response = Gateway.get!(url)</span></span><br><span class="line"><span class="comment">#    items = Poison.decode!(response.body)</span></span><br><span class="line"><span class="comment">#    links_map = </span></span><br><span class="line"><span class="comment">#      response.headers</span></span><br><span class="line"><span class="comment">#      |&gt; Enum.find_value(fn(&#123;k, v&#125;) -&gt; k == "Link" &amp;&amp; v end)</span></span><br><span class="line"><span class="comment">#      |&gt; parse_links</span></span><br><span class="line"><span class="comment">#    &#123;items, links_map["next"]&#125;</span></span><br><span class="line"><span class="comment">#  end</span></span><br><span class="line">iex(<span class="number">1</span>)&gt; <span class="constant">Github.ResultStream.</span>parse_links(<span class="string">"&lt;https://api.github.com/organizations/9950313/repos?page=2&gt;; rel=\"next\", &lt;https://api.github.com/organizations/9950313/repos?page=3&gt;; rel=\"last\""</span>)</span><br><span class="line">%&#123;<span class="string">"last"</span> =&gt; <span class="string">"/organizations/9950313/repos?page=3"</span>,</span><br><span class="line">  <span class="string">"next"</span> =&gt; <span class="string">"/organizations/9950313/repos?page=2"</span>&#125;</span><br><span class="line">iex(<span class="number">2</span>)&gt; v(<span class="number">1</span>)[<span class="string">"next"</span>]</span><br><span class="line"><span class="string">"/organizations/9950313/repos?page=2"</span></span><br><span class="line">iex(<span class="number">3</span>)&gt; <span class="constant">Github.ResultStream.</span>parse_links(<span class="keyword">nil</span>)</span><br><span class="line">%&#123;&#125;</span><br><span class="line">iex(<span class="number">4</span>)&gt; %&#123;&#125;[<span class="string">"next"</span>]</span><br><span class="line"><span class="keyword">nil</span></span><br></pre></td></tr></table></figure>
<p>With that, you should now know how our <code>Stream.resource/3</code>‘s <code>start_fun</code> works and what our first <code>acc</code> (for <code>next_fun</code>) will look like. Our first <code>acc</code> will be <code>{items, nil | BitString}</code> where <code>items</code> is the list of maps decoded by <code>Poison</code> (i.e. the repos data), and the second element in the tuple is either <code>nil</code> if there’s no more data to get through pagination, or the link to follow if there is.</p>
<p>Now, the only thing left is understanding our <code>next_fun</code>:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">defp</span> <span class="title">process_page</span></span>(&#123;<span class="keyword">nil</span>, <span class="keyword">nil</span>&#125;) <span class="keyword">do</span></span><br><span class="line">  &#123;<span class="symbol">:halt</span>, <span class="keyword">nil</span>&#125;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">defp</span> <span class="title">process_page</span></span>(&#123;<span class="keyword">nil</span>, next_page_url&#125;) <span class="keyword">do</span></span><br><span class="line">  next_page_url</span><br><span class="line">  |&gt; fetch_page</span><br><span class="line">  |&gt; process_page</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">defp</span> <span class="title">process_page</span></span>(&#123;items, next_page_url&#125;) <span class="keyword">do</span></span><br><span class="line">  &#123;items, &#123;<span class="keyword">nil</span>, next_page_url&#125;&#125;</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>First off, know that this is pattern matching at work again and that pattern matching happens top-to-bottom. So if we pass <code>process_page/1</code> no data and no next link - <code>{nil, nil}</code> - the first clause will match and it’ll give us back <code>{:halt, nil}</code> (this will always happen at some point because this thing’s recursive and that’s the base case).</p>
<p>Let’s take the case of <code>fetch_page(&quot;/orgs/elixir-lang/repos&quot;)</code>, which as we saw before, doesn’t have enough data to need pagination - hopefully that will change soon ;)</p>
<p>In <em>elixir-lang</em>‘s case, it’s <code>{items, nil}</code> where <code>items</code> isn’t <code>nil</code> (thankfully!). This means the 3rd clause will match and our first evaluation of <code>process_page/1</code> gives <code>{items, {nil, nil}}</code>.</p>
<p>Remember from our discussion of <a href="#Stream-resource/3">Stream.resource/3 above</a> that the first element in the tuple returned by <code>Stream.resource/3</code>‘s <code>next_fun</code>, if not <code>:halt</code>, is a list of data, the data which our stream produces. We’re basically passing that data to <code>Stream.resource/3</code> and using the second element in the tuple (the accumulator) to keep getting more data (until exhaustion), through <code>next_fun</code> - which is now invoked again with <code>{nil, nil}</code> and we already know what will happen next.</p>
<p>But what if we were querying something like “/orgs/nodejs/repos”? In that case, <code>next_page_url</code> would not be <code>nil</code> and our <code>acc</code> would be <code>{nil, url}</code>. The next time our stream is forced for more data, <code>next_fun</code> will be called with this <code>acc</code> which would match the 2nd clause. This will hit Github’s API for the next paginated data, and return <code>{:halt, nil}</code> if no data comes back, or <code>{items, {nil, nil | next_page_url}}</code> if there is data (note that it would be problematic if Github’s API would, for some weird reason (a.k.a bug), return no data but also include a “Link” header with a next URL to follow in its reply as we would basically end up in an infinite loop).</p>
<p>In the spirit of being explicit about anything that might be ambiguous (a.k.a might as well go all the way), if Github comes back with data <em>and</em> a “Link” header with a next URL to follow, then when our stream is forced for more data, <code>process_page/1</code> will be called with <code>{nil, next_page_url}</code></p>
<p>If Github returns no “Link” header with a next URL to follow, then when our stream is next forced for more data, <code>process_page/1</code> will be called with <code>{nil, nil}</code>, but <em>in both cases</em> the data Github returned is fed back to <code>Stream.resource/3</code> via <code>items</code>.</p>
<h1 id="Test-drive"><a href="#Test-drive" class="headerlink" title="Test drive"></a>Test drive</h1><p>The <code>Github</code> module below exposes a clean API to our users:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># lib/github.ex</span></span><br><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">Github</span></span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">alias</span> <span class="constant">Github.ResultStream</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">repos</span></span>(organization) <span class="keyword">do</span></span><br><span class="line">    <span class="constant">ResultStream.</span>new(<span class="string">"/orgs/<span class="subst">#&#123;organization&#125;</span>/repos"</span>)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>Below taking this thing for a spin, go ahead and add <code>IO.puts(&quot;Url: #{url}&quot;)</code> to <code>Github.Gateway.process_url/1</code> so we can confirm how many requests are being made (as we’ve seen before, HTTPoison uses this function internally):</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">iex(<span class="number">1</span>)&gt; repo_stream = <span class="string">"nodejs"</span> |&gt; <span class="constant">Github.</span>repos |&gt;</span><br><span class="line">...(<span class="number">1</span>)&gt;   <span class="constant">Stream.</span>map(<span class="keyword">fn</span> repo_map -&gt; &#123;repo_map[<span class="string">"full_name"</span>], repo_map[<span class="string">"forks"</span>]&#125; <span class="keyword">end</span>)</span><br><span class="line"><span class="comment">#Stream&lt;[enum: #Function&lt;46.94256892/2 in Stream.resource/3&gt;,</span></span><br><span class="line"> <span class="symbol">funs:</span> [<span class="comment">#Function&lt;29.94256892/1 in Stream.map/2&gt;]]&gt;</span></span><br><span class="line">iex(<span class="number">2</span>)&gt; repo_stream |&gt; <span class="constant">Enum.</span>take(<span class="number">4</span>)</span><br><span class="line"><span class="constant">Url:</span> /orgs/nodejs/repos</span><br><span class="line">[&#123;<span class="string">"nodejs/http-parser"</span>, <span class="number">641</span>&#125;, &#123;<span class="string">"nodejs/node-v0.x-archive"</span>, <span class="number">8508</span>&#125;,</span><br><span class="line"> &#123;<span class="string">"nodejs/node-gyp"</span>, <span class="number">354</span>&#125;, &#123;<span class="string">"nodejs/readable-stream"</span>, <span class="number">67</span>&#125;]</span><br><span class="line">iex(<span class="number">3</span>)&gt; repo_stream |&gt; <span class="constant">Enum.</span>take(<span class="number">40</span>)</span><br><span class="line"><span class="constant">Url:</span> /orgs/nodejs/repos</span><br><span class="line"><span class="constant">Url:</span> /organizations/<span class="number">9950313</span>/repos?page=<span class="number">2</span></span><br><span class="line">[&#123;<span class="string">"nodejs/http-parser"</span>, <span class="number">641</span>&#125;, &#123;<span class="string">"nodejs/node-v0.x-archive"</span>, <span class="number">8508</span>&#125;,</span><br><span class="line"> &#123;<span class="string">"nodejs/node-gyp"</span>, <span class="number">354</span>&#125;, &#123;<span class="string">"nodejs/readable-stream"</span>, <span class="number">67</span>&#125;,</span><br><span class="line"> &#123;<span class="string">"nodejs/node-addon-examples"</span>, <span class="number">140</span>&#125;, &#123;<span class="string">"nodejs/nan"</span>, <span class="number">180</span>&#125;,</span><br><span class="line"> &#123;<span class="string">"nodejs/nodejs.org-archive"</span>, <span class="number">83</span>&#125;, &#123;<span class="string">"nodejs/build"</span>, <span class="number">26</span>&#125;,</span><br><span class="line"> &#123;<span class="string">"nodejs/roadmap"</span>, <span class="number">34</span>&#125;, &#123;<span class="string">"nodejs/build-containers"</span>, <span class="number">5</span>&#125;, &#123;<span class="string">"nodejs/node"</span>, <span class="number">2382</span>&#125;,</span><br><span class="line"> &#123;<span class="string">"nodejs/iojs.org"</span>, <span class="number">138</span>&#125;, &#123;<span class="string">"nodejs/logos"</span>, <span class="number">40</span>&#125;, &#123;<span class="string">"nodejs/docker-node"</span>, <span class="number">72</span>&#125;,</span><br><span class="line"> &#123;<span class="string">"nodejs/build-container-sync"</span>, <span class="number">2</span>&#125;, &#123;<span class="string">"nodejs/doc-tool"</span>, <span class="number">7</span>&#125;,</span><br><span class="line"> &#123;<span class="string">"nodejs/docker-iojs"</span>, <span class="number">28</span>&#125;, &#123;<span class="string">"nodejs/tracing-wg"</span>, <span class="number">8</span>&#125;, &#123;<span class="string">"nodejs/nodejs-es"</span>, <span class="number">3</span>&#125;,</span><br><span class="line"> &#123;<span class="string">"nodejs/nodejs-ko"</span>, <span class="number">31</span>&#125;, &#123;<span class="string">"nodejs/nodejs-nl"</span>, <span class="number">2</span>&#125;, &#123;<span class="string">"nodejs/nodejs-de"</span>, <span class="number">4</span>&#125;,</span><br><span class="line"> &#123;<span class="string">"nodejs/nodejs-pt"</span>, <span class="number">6</span>&#125;, &#123;<span class="string">"nodejs/nodejs-ru"</span>, <span class="number">14</span>&#125;, &#123;<span class="string">"nodejs/nodejs-fr"</span>, <span class="number">6</span>&#125;,</span><br><span class="line"> &#123;<span class="string">"nodejs/nodejs-da"</span>, <span class="number">1</span>&#125;, &#123;<span class="string">"nodejs/nodejs-hi"</span>, <span class="number">2</span>&#125;, &#123;<span class="string">"nodejs/nodejs-ja"</span>, <span class="number">9</span>&#125;,</span><br><span class="line"> &#123;<span class="string">"nodejs/nodejs-no"</span>, <span class="number">5</span>&#125;, &#123;<span class="string">"nodejs/nodejs-hu"</span>, <span class="number">4</span>&#125;, &#123;<span class="string">"nodejs/nodejs-he"</span>, <span class="number">1</span>&#125;,</span><br><span class="line"> &#123;<span class="string">"nodejs/nodejs-it"</span>, <span class="number">1</span>&#125;, &#123;<span class="string">"nodejs/nodejs-sv"</span>, <span class="number">0</span>&#125;, &#123;<span class="string">"nodejs/nodejs-tr"</span>, <span class="number">4</span>&#125;,</span><br><span class="line"> &#123;<span class="string">"nodejs/nodejs-ka"</span>, <span class="number">0</span>&#125;, &#123;<span class="string">"nodejs/nodejs-mk"</span>, <span class="number">0</span>&#125;, &#123;<span class="string">"nodejs/nodejs-pl"</span>, <span class="number">0</span>&#125;,</span><br><span class="line"> &#123;<span class="string">"nodejs/nodejs-el"</span>, <span class="number">1</span>&#125;, &#123;<span class="string">"nodejs/nodejs-id"</span>, <span class="number">6</span>&#125;, &#123;<span class="string">"nodejs/nodejs-cs"</span>, <span class="number">0</span>&#125;]</span><br></pre></td></tr></table></figure>
<p>As we saw with <code>curl</code> + <code>jq</code> in the <a href="#How_to_fetch_Github_organization_repos_and_their_pagination">How to fetch Github organization repos and their pagination</a>, Github will only ever give us a max of 30 repos per request, so when we <code>Enum.take(40)</code> in <code>iex(2)</code> above, we get the second request’s URL printed out as our stream needs to paginate. In comparison, only one request ever happens in <code>iex(1)</code> which only ever takes 4 repos from the stream.</p>
<h1 id="How-to-install-Elixir-with-asdf"><a href="#How-to-install-Elixir-with-asdf" class="headerlink" title="How to install Elixir with asdf"></a>How to install Elixir with asdf</h1><p><a href="https://github.com/HashNuke/asdf" target="_blank" rel="external">asfd</a> is an extendable version manager for a couple of platforms (currently, <a href="https://github.com/HashNuke/asdf-ruby" target="_blank" rel="external">Ruby</a>, <a href="https://github.com/HashNuke/asdf-nodejs" target="_blank" rel="external">Node.js</a>, <a href="https://github.com/HashNuke/asdf-elixir" target="_blank" rel="external">Elixir</a>, <a href="https://github.com/HashNuke/asdf-erlang" target="_blank" rel="external">Erlang</a>, and <a href="https://github.com/Stratus3D/asdf-lua" target="_blank" rel="external">Lua</a>) i.e. you can use it to install, uninstall, and change between different versions of the supported platforms.</p>
<p>To install it on your system, simply <code>git clone https://github.com/HashNuke/asdf.git ~/.asdf</code> and source it from a startup script like <code>.bashrc</code> or <code>.bash_profile</code> or similar, by running:</p>
<p><code>echo &#39;. $HOME/.asdf/asdf.sh&#39; &gt;&gt; ~/.bash_profile</code></p>
<p>i.e. append <code>. $HOME/.asdf/asdf.sh</code> to <code>~/.bash_profile</code>.</p>
<p>To get started using Elixir, you then need to install both Erlang and Elixir on your system using the respective asdf plugin for each:</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ </span>asdf plugin-add erlang <span class="symbol">https:</span>/<span class="regexp">/github.com/</span><span class="constant">HashNuke</span>/asdf-erlang.git</span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"><span class="variable">$ </span>asdf list-all erlang</span><br><span class="line"><span class="number">18.1</span></span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"><span class="variable">$ </span>asdf install erlang <span class="number">18.1</span></span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"><span class="variable">$ </span>asdf plugin-add elixir <span class="symbol">https:</span>/<span class="regexp">/github.com/</span><span class="constant">HashNuke</span>/asdf-elixir.git</span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"><span class="variable">$ </span>asdf list-all elixir</span><br><span class="line"><span class="comment"># 1.1.1</span></span><br><span class="line"><span class="comment"># .... <span class="doctag">Note:</span> don't worry if 1.2.0 is not listed, install it anyway (the list is hard-coded)</span></span><br><span class="line"><span class="variable">$ </span>asdf install elixir <span class="number">1.2</span>.<span class="number">0</span></span><br><span class="line"><span class="comment"># ...</span></span><br></pre></td></tr></table></figure>
<p>One last thing I’d like to point out about asdf is its <a href="https://github.com/HashNuke/asdf#the-tool-versions-file" target="_blank" rel="external">.tool-versions</a> feature which you can use to set default versions of the tools you use, both globally (by using it in your home directory), as well as on a per-project basis.</p>

        
        
            
        
    </div>
    <div class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">TAGGED IN</span><br/>
                
    <a class="tag tag--primary tag--small t-link" href="/tags/elixir/">elixir</a>

            </div>
        
        <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2016/04/17/serving-a-webpack-bundle-in-spring-boot/"  data-tooltip="Serving a Webpack bundle in Spring Boot">
                
                    <i class="fa fa-angle-left"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                </a>
            </li>
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2015/12/26/ruby-on-rails-vagrant-box/" data-tooltip="Creating a Ruby on Rails Vagrant box">
                
                    <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                    <i class="fa fa-angle-right"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions"  href="#btn-open-shareoptions">
                <i class="fa fa-share-alt"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=http://justincalleja.com/2016/01/26/elixir-streams-reload/">
                <i class="fa fa-google-plus"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://justincalleja.com/2016/01/26/elixir-streams-reload/">
                <i class="fa fa-facebook-official"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=http://justincalleja.com/2016/01/26/elixir-streams-reload/">
                <i class="fa fa-twitter"></i>
            </a>
        </li>
        
            <li class="post-action">
                <a class="post-action-btn btn btn--default" href="#disqus_thread">
                    <i class="fa fa-comment-o"></i>
                </a>
            </li>
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#">
            
                <i class="fa fa-list"></i>
            </a>
        </li>
    </ul>
</div>
        
            <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2020 Justin Calleja.
    </span>
    <small class="attribution">Powered by <a href="https://hexo.io/" title="Hexo" target="_blank" rel="external">Hexo</a> with <a href="https://github.com/LouisBarranqueiro/tranquilpeak-hexo-theme" title="Tranquilpeak" target="_blank" rel="external">Tranquilpeak</a> theme by <a href="https://github.com/LouisBarranqueiro" title="Louis Barranqueiro" target="_blank" rel="external">Louis Barranqueiro</a></small>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="1">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2016/04/17/serving-a-webpack-bundle-in-spring-boot/"  data-tooltip="Serving a Webpack bundle in Spring Boot">
                
                    <i class="fa fa-angle-left"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                </a>
            </li>
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2015/12/26/ruby-on-rails-vagrant-box/" data-tooltip="Creating a Ruby on Rails Vagrant box">
                
                    <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                    <i class="fa fa-angle-right"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions"  href="#btn-open-shareoptions">
                <i class="fa fa-share-alt"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=http://justincalleja.com/2016/01/26/elixir-streams-reload/">
                <i class="fa fa-google-plus"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://justincalleja.com/2016/01/26/elixir-streams-reload/">
                <i class="fa fa-facebook-official"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=http://justincalleja.com/2016/01/26/elixir-streams-reload/">
                <i class="fa fa-twitter"></i>
            </a>
        </li>
        
            <li class="post-action">
                <a class="post-action-btn btn btn--default" href="#disqus_thread">
                    <i class="fa fa-comment-o"></i>
                </a>
            </li>
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#">
            
                <i class="fa fa-list"></i>
            </a>
        </li>
    </ul>
</div>
                </div>
                <div id="share-options-bar" class="share-options-bar" data-behavior="1">
    <ul class="share-options">
        <li class="share-option">
            <a class="share-option-btn" target="new" href="https://plus.google.com/share?url=http://justincalleja.com/2016/01/26/elixir-streams-reload/">
                <i class="fa fa-google-plus"></i><span class="">Share on Google Plus</span>
            </a>
        </li>
        <li class="share-option">
            <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://justincalleja.com/2016/01/26/elixir-streams-reload/">
                <i class="fa fa-facebook-official"></i><span>Share on Facebook</span>
            </a>
        </li>
        <li class="share-option">
            <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=http://justincalleja.com/2016/01/26/elixir-streams-reload/">
                <i class="fa fa-twitter"></i><span>Share on Twitter</span>
            </a>
        </li>
    </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>
            
        </div>
        <div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-remove"></i>
        </div>
        
            <h4 id="about-card-name">Justin Calleja</h4>
        
        
        
            <h5 id="about-card-location">
                <i class="fa fa-map-marker"></i>
                <br/>
                Malta
            </h5>
        
    </div>
</div>
        <div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
    </body>
    <!--SCRIPTS-->
<script src="/assets/js/jquery.js" type="text/javascript"></script>
<script src="/assets/js/jquery.fancybox.js" type="text/javascript"></script>
<script src="/assets/js/jquery.fancybox-thumbs.js" type="text/javascript"></script>
<script src="/assets/js/tranquilpeak.js" type="text/javascript"></script>
<!--SCRIPTS END-->

    <script type="text/javascript">
        var disqus_shortname = 'justincalleja';
        (function() {
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>


    <script type="text/javascript">
        (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
                (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
            e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
        })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

        _st('install','11bRT8o5XAX6-5fzFhD7','2.0.0');
    </script>


</html>
